///////////////////////////////////////////////////////////////////////////////

11/07

TODO:
0.5 Trace sample_audio.c
1. Feed PCM file to memory, DMA to AIO, and then DA to output
2. Feed PCM file to memory, DMA to AIO, and I2S to HDMI TX 

* Trace option 2: read audio stream from file, decode and send to AO
* SAMPELE_AUDIO_AdecAo();
* SAMPLE_COMM_AUDIO_CfgAcodec();










///////////////////////////////////////////////////////////////////////////////

11/06

arm-hisiv500-linux-objcopy --gap-fill=0xff -O binary u-boot u-boot.bin
osdrv/tools/pc_tools/uboot_tools/
mkboot.sh reg_info.bin u-boot-hi3519v101.bin
# mw.b 0x82000000 ff 0x100000
# tftp 0x82000000 u-boot.bin
# sf probe 0
# sf erase 0x0 0x100000
# sf write 0x82000000 0x0 0x100000


Q: How can GNU toolchain relocate u-boot binary image when linking archive files?

Q: How do I know the address where u-boot stores environment parameters?

BOOT_SEL0

HiTool: using usb-to-serial is better than using on-mainboard uart port.

SW1.3 ->1 bootrom; ->0 

Q: What is the difference between PCM and I2S?
I2S:
  * 4-wire interface: bit clocke (BCLK), left/right clock (LRC), Tx, Rx lines
  * 3 operating modes: I2S, left justfied, right justfied
PCM:
  * 4-wire interface: bit clocke (BCLK), sync (SYNC), Tx, Rx lines
  * 2 operating modes: A and B

references:
1. kernel documentation on Digital Audio Interface [link](Documentation/sound/alsa/soc/DAI.txt)
2. [link](http://blog.csdn.net/azloong/article/details/6536855)


///////////////////////////////////////////////////////////////////////////////
11/03

Q: How to compile a dts file?


Q: Where Kocha code is?
  ap.git/dm365/interface/avm/kocha_*

Hi3519V101 SDK setup the SoC in u-boot:
1. from osdrv/tools/pc/uboot_tools/mkboot.sh 
original u-boot is split into two 
[first 64 byte][reg_info data up to 5120 bytes, padded with 0][the rest of u-boot]


Q: How to show a binary file?
  hexdump -C <file>
  dhex <file>
Q: How to compare two binary files?
  cmp -l <file 1> <file 2>
Q: How to use visual tool to compare two binary files
  vbindiff <file 1> <file 2>


Hi3519V101-uboot-DDR3_1866M_32bit_1GB-A7_792M-A17_930M-BUS_200M.xls


Q: How to copy to the clipboard in OpenBox?
  Ctrl+Shift+C to copy; mouse mid-button to paste




references:
  [1] https://lists.denx.de/pipermail/u-boot/2008-May/034702.html


///////////////////////////////////////////////////////////////////////////////
11/02

Q: v4l2-framework.txt does not talk about video buffer. What else talks about it?

Q: How to use I2S of Si3519V101 and make HDMI out with stereo audio? (Dave)

On the chip, pins relating to I2S input and output are:
AB23: JTAG_EN

AB24: I2S_BCLK_TX
AC23: I2S_WS_TX
AD23: I2S_SD_TX

AC24: I2S_MCLK

AC22: I2S_BCLK_RX
AB21: I2S_WS_RX
AD22: I2S_SD_RX

1. Remove R74 to disable JTAG function
2. Connect to SD0/1/2/3/MCLK/SCK/WS_DR0

Q: How to select pin functions of Si3519V101 (setup pin multiplexing)?

Q: hisi-hi3519v101-demb.dts and hisi-hi3519v101-hmp-demb.dts - which is in use?

Q: How does a bootloader bring dtb to kernel?
bootm <address> - <>

Q: Must dtb explicitly load via u-boot bootm? This article said dtb can be integrated into uboot or separately loaded [link](http://blog.csdn.net/ooonebook/article/details/53206623)

* Device Tree
  * ARM Linux 2.6，arch/arm/plat-xxx和arch/arm/mach-xxx中充斥着描述板级细节的代码
    * 板上的platform设备、resource、i2c_board_info、spi_board_info以及各种硬件的platform_data。
  * 是一种描述硬件的数据结构
  * 画一棵电路板上CPU、总线、设备组成的树
  * 结点（node）和属性（property）组成
    * 结点本身可包含子结点
    * 属性是成对出现的name和value
  * DTS (device tree source) -> DTC (device tree compiler) -> Device Tree Blob (.dtb) 
  * bootloader将这棵树传递给内核在引导kernel的过程中，会先读取该.dtb到内存。
  * .dtsi: 提炼SoC公用的部分或者多个machine共同的部分



references:
[1] ARM Linux 3.x的设备树（Device Tree）宋宝华 http://blog.csdn.net/21cnbao/article/details/8457546
[2] The Devicetree Specification https://www.devicetree.org/
[3] Thomas Petazzoni, Device Tree for Dummies. Presentation [link](http://free-electrons.com/pub/conferences/2013/elce/petazzoni-device-tree-dummies/petazzoni-device-tree-dummies.pdf); talk for Embedded Linux Conference Europe [link](https://youtu.be/m_NyYEBxfn8)
[4] Device Tree Usage [link](https://elinux.org/Device_Tree_Usage) 
  targeting at how to write a device tree for a new machine
[5] Kernel documentation [link](Documentation/devicetree)

///////////////////////////////////////////////////////////////////////////////
11/01

How to write an i2c-controlled video decoder/encoder driver?

* V4L2 driver tends to be complex. 
  => V4L2 framework, providing basic building blocks
* V4L2 drivers apple to audio/video muxing/encoding/decoding ICs, "sub-devices",
  * connected to the main bridge driver through I2C busses
  * bus or host controller is called a parent device
* example: v4l2-pci-skeleton.c, a skeleton driver for a PCI capture card
* structure of a driver must have
  * the device state: one for each device instance
  * a way to init and command sub-devices
  * create v4l2 device nodes and device-node specific data
  * Filehandle-specific structs and per-filehandle data
  * video buffer handling

references:
1. Overview of the V4L2 driver framework [link](http://elixir.free-electrons.com/linux/v3.18.20/source/Documentation/video4linux/v4l2-framework.txt)
2. [link](http://elixir.free-electrons.com/linux/v3.18.20/source/Documentation/video4linux/v4l2-controls.txt)
3. [link](https://archive.fosdem.org/2014/schedule/event/v4l_intro/attachments/slides/448/export/events/attachments/v4l_intro/slides/448/v4l2_frameworks.pdf)




struct xxx_state {
	struct v4l2_subdev sd;
	struct v4l2_ctrl_handler ctrl_handler;
	...
};


#include <v4l2/v4l2-common.h>

/* fill in all the fields of v4l2_subdev;
   ensure the v4l2_subdev and i2c_client both point to one another */
v4l2_i2c_subdev_init(&state->sd, client, subdev_ops); 

v4l2_ctrl_handler_init(&state->ctrl_handler, nr_of_controls);

static inline struct xxx_state *to_state(struct v4l2_subdev *sd)
{
	return container_of(sd, struct xxx_state, sd);
}

struct i2c_client *client = v4l2_get_subdevdata(sd);
struct v4l2_subdev *sd = i2c_get_clientdata(client);


v4l2_device_unregister_subdev(sd);


TODO:
v4l2_i2c_new_subdev(v4l2_dev, adapter, "module_foo", "chipid", 0x36, NULL);



---------------------------------------------------------------------------------------

sample_tde shows a quarter sized backgroud with some pictures moving around.



---------------------------------------------------------------------------------------
Good resoures: http://free-electrons.com/doc/legacy/


-------------------------------------------------------------------------------








object檔修改工具 - objcopy


-------------------------------------------------------------------------------

## 亂序執行
* out-of-order execution
* aka: OoOE, OOE

ref
* Out-of-order execution [link](https://en.wikipedia.org/wiki/Out-of-order_execution)
* 乱序执行 [link](https://zh.wikipedia.org/wiki/%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C)

-------------------------------------------------------------------------------

ref
* http://capricorn-liver.blogspot.tw/2010/11/cbmp.html

-------------------------------------------------------------------------------
## GUID Partition Table
* aka GPT
* a part of the Unified Extensible Firmware Interface (UEFI) standard, as a replacement for the PC BIOS
* MBR (Master boot record) partitioning scheme
  * The original version of the MBR was written by David Litton of IBM in June 1982
  * introduced with IBM PC DOS 2.0 in March 1983 in order to support the 10 MB hard disk of the then-new IBM Personal Computer XT, still using the FAT12 file system
  * use 32 bits for storing block addresses
  * limit: 512 bytes/sector * (2 ^ 32) = 2 ^ 41 = 2 Tbytes maximum

* advantages over the MBR: 
  * use 64 bits for storing block addresses
  * limit: 512 bytes/sector * (2 ^ 64) = 2 ^ 73 = 8 Zbytes maximum
  * more partitions is possible, depending on operating system supports
  * TODO
    
* Major Linux distros support GPT: Fedora above 8, Ubuntu above 8.04+ with tools such as gdisk, GNU Parted, util-linux v2.23+ fdisk, SYSLINUX, GRUB 0.96 + patches and GRUB 2 have been GPT-enabled.
  * kernel config CONFIG_EFI_PARTITION option enables GPT support in the kernel
    
  * command "blkid"
  * command "gdisk"
  * command "lsblk"
  
* ref
  * wiki MBR [link](https://en.wikipedia.org/wiki/Master_boot_record)
  * wiki GPT [link](https://en.wikipedia.org/wiki/GUID_Partition_Table)
  * k-M-G-T-P-E-Z-Y [link](http://ioanaspune.ro/wp-content/uploads/2015/03/tabel-1014x1024.jpg)
  * GPT kernel support [link](https://wiki.archlinux.org/index.php/partitioning#GPT_Kernel_Support)
  * TI Linux Core U-Boot User's Guide talking about how to use u-boot to make a GPT eMMC and boot from it [link](http://processors.wiki.ti.com/index.php/Linux_Core_U-Boot_User%27s_Guide)
  
## File System
  
  
  
* ref
  * Kernel NTFS driver vs NTFS-3G [link](https://superuser.com/questions/139452/kernel-ntfs-driver-vs-ntfs-3g)
  * 筆記 linux-support-ntfs-by-ntfs-3g [link](http://paul.pixnet.net/blog/post/11120651-%5B%E7%AD%86%E8%A8%98%5Dlinux-support-ntfs-by-ntfs-3g)
  


## Build GStreamer with cerbero

```
$ git clone git://anongit.freedesktop.org/gstreamer/cerbero
$ ./cerbero-uninstalled -c config/xxx.cbc bootstrap
```
wipe : Wipes everything to restore the build system
bootstrap : 下载并安装当前环境下编译时所需工具
build : 编译某个recipe，包括其依赖项
buildone : 编译某个recipe，不包括其依赖项
cleanone : 清理某个recipe

```
$ ./cerbero-uninstalled -c config/xxx.cbc package gstreamer-1.0
```

reference:
* Building from source using Cerbero [link](https://gstreamer.freedesktop.org/documentation/installing/building-from-source-using-cerbero.html)
* GStreamer SDK 1.0 Build Via Cerbero [link](http://www.jianshu.com/p/7863404c1909)















---------------------------------------------------------------------------------------



WARNING: No specific packager available for the distro version none_uclibc, using generic packager for distro none
-----> Creating package for gstreamer-1.0
WARNING: Some libraries weren't found while searching!
libgstgl-1.0
WARNING: Some libraries weren't found while searching!
libwebrtc_audio_processing
WARNING: Some libraries weren't found while searching!
libgstvalidate-preload-1.0
***** Error running 'package' command:
The following files required by this package are missing:
 lib/gstreamer-1.0/libgstopengl.so
lib/gstreamer-1.0/libgstaudiovisualizers.so



---------------------------------------------------------------------------------------

How to modify git site




---------------------------------------------------------------------------------------








Download the source
    https://gstreamer.freedesktop.org/download/

./configure CC=arm-linux-gnueabi-gcc CXX=arm-linux-gnurabi-g++ --host=arm-linux --build=i686-linux --prefix=/home/kclin/workspace/cross_result/pkg_config/ RANLIB=arm-linux-gnueabi-ranlib LD=arm-linux-gnueabi-ld --cache-file=arm-linux.cache LIBS="-L/home/kclin/workspace/cross_result/pkg_config/lib -lffi" CFLAGS="-I/home/kclin/workspace/cross_result/pkg_config/lib/libffi-3.0.13/include -I/home/kclin/workspace/cross_result/pkg_config/include"

make && make install



make OSDRV_CROSS=arm-hisiv500-linux CHIP=hi3519v101 FLASH_TYPE=spi all


a003257@ubuntu:~/avm/T533C$ ./sdk.unpack 
Unpacking SDK
WARN: Be sure you have installed the cross-compiler. if not, install it first!
WARN: ALL THE SOUCE FILES WILL BE OVERWRITED, FILES YOU MOTIFIED WILL BE LOST !!!

OS_TYPE  =linux
SDK_CHIP =hi3519v101
CUSTOMER_VERSION =
unpacking osal
run_command_progress_float: 'tar -xvzf package/osal.tgz'
[100%]##################################################|
unpacking osdrv
run_command_progress_float: 'tar -xvzf package/osdrv.tgz'
[100%]##################################################|
unpacking linux kernel
run_command_progress_float: 'tar -xvzf osdrv/opensource/kernel/linux-3.18.y.tgz -C osdrv/opensource/kernel/'
[100%]##################################################|
unpacking mpp_big-little
mkdir: created directory 'mpp_big-little'
run_command_progress_float: 'tar -xvzf package/mpp_big-little.tgz'
[100%]##################################################|
unpacking drv
mkdir: created directory 'drv'
run_command_progress_float: 'tar -xvzf package/drv.tgz'
[100%]##################################################|




hisilicon # printenv
bootdelay=1
baudrate=115200
bootfile="uImage"
filesize=4B9D7C
fileaddr=82000000
netmask=255.255.255.0
bootargs=mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs)
bootcmd=sf probe 0;sf read 0x82000000 0x100000 0x300000;bootm 0x82000000

serverip=10.1.9.108
nfshost=10.1.9.108
ipaddr=10.1.9.124
gatewayip=10.1.9.254
ethaddr=00:00:23:34:45:66

stdin=serial
stdout=serial
stderr=serial
verify=n
ver=U-Boot 2010.06 (Nov 30 2016 - 19:59:33)




setenv bootargs mem=64M console=ttyAMA0,115200 


setenv bootargs mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp

setenv bootargs mem=32M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp


set bootcmd 'sf probe 0;sf read 0x82000000 0x100000 0x300000;bootm 0x82000000'
set bootargs 'mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp'
set ipaddr 192.168.0.50
set serverip 192.168.0.100



---------------------------------------------------------------------------------------
ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- 
---------------------------------------------------------------------------------------


hisilicon # printenv
bootdelay=1
baudrate=115200
bootfile="uImage"
filesize=4B9D7C
fileaddr=82000000
netmask=255.255.255.0
bootargs=mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs)
bootcmd=sf probe 0;sf read 0x82000000 0x100000 0x300000;bootm 0x82000000
serverip=10.1.9.108
nfshost=10.1.9.108
ipaddr=10.1.9.124
gatewayip=10.1.9.254
ethaddr=00:00:23:34:45:66
stdin=serial
stdout=serial
stderr=serial
verify=n
ver=U-Boot 2010.06 (Nov 30 2016 - 19:59:33)




setenv bootargs mem=64M console=ttyAMA0,115200 


setenv bootargs mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp

setenv bootargs mem=32M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp






sample/vio/sample_vio.c

__HuaweiLite__ is NOT used.

VO_INTF g_enVoIntfType video output interafce type

SAMPLE_VI_CONFIG_S video input configuration type

SENSOR_TYPE is defined in sample/Makefile.param

struct is typedefined as _S.


(gst-inspect-1.0:148): GStreamer-WARNING **: External plugin loader failed. This most likely means that the plugin loader helper binary was not found or could no.

(gst-inspect-1.0:148): GStreamer-WARNING **: Failed to load plugin '/mnt/linux_armv7/lib/gstreamer-1.0/libgstlibav.so': File not found

./gst-inspect-1.0: symbol '_ZN2cv3Mat10deallocateEv': can't resolve symbol

./gst-inspect-1.0: symbol 'cvCreateImageHeader': can't resolve symbol

./gst-inspect-1.0: symbol 'cvReleaseImage': can't resolve symbol

./gst-inspect-1.0: symbol '_ZN9_IplImageC1ERKN2cv3MatE': can't resolve symbol

./gst-inspect-1.0: symbol 'cvCopy': can't resolve symbol

./gst-inspect-1.0: symbol 'cvCreateImage': can't resolve symbol

./gst-inspect-1.0: symbol '_ZN2cv8fastFreeEPv': can't resolve symbol

(gst-inspect-1.0:148): GStreamer-WARNING **: Failed to load plugin '/mnt/linux_armv7/lib/gstreamer-1.0/libgstavtremovebgsink.so': unknown dl-error

(gst-inspect-1.0:148): GStreamer-WARNING **: Failed to load plugin '/mnt/linux_armv7/lib/gstreamer-1.0/libgstmatroska.so': File not found
/mnt/linux_armv7/bin # ./gst-inspect-1.0 | tee 2>&1 /mnt/inspect.log

(gst-inspect-1.0:150): GStreamer-WARNING **: External plugin loader failed. This most likely means that the plugin loader helper binary was not found or could no.

(gst-inspect-1.0:150): GStreamer-WARNING **: Failed to load plugin '/mnt/linux_armv7/lib/gstreamer-1.0/libgstlibav.so': File not found

./gst-inspect-1.0: symbol '_ZN2cv3Mat10deallocateEv': can't resolve symbol

./gst-inspect-1.0: symbol 'cvCreateImageHeader': can't resolve symbol

./gst-inspect-1.0: symbol 'cvReleaseImage': can't resolve symbol

./gst-inspect-1.0: symbol '_ZN9_IplImageC1ERKN2cv3MatE': can't resolve symbol

./gst-inspect-1.0: symbol 'cvCopy': can't resolve symbol

./gst-inspect-1.0: symbol 'cvCreateImage': can't resolve symbol

./gst-inspect-1.0: symbol '_ZN2cv8fastFreeEPv': can't resolve symbol

(gst-inspect-1.0:150): GStreamer-WARNING **: Failed to load plugin '/mnt/linux_armv7/lib/gstreamer-1.0/libgstavtremovebgsink.so': unknown dl-error

(gst-inspect-1.0:150): GStreamer-WARNING **: Failed to load plugin '/mnt/linux_armv7/lib/gstreamer-1.0/libgstmatroska.so': File not found

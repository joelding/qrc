************************
          TODO
************************

*** 隨手記錄工作上碰到的問題與解答 ***

///////////////////////////////////////////////////////////////////////////

02/23 FRI



///////////////////////////////////////////////////////////////////////////

02/22 THU

iPerf - The ultimate speed test tool for TCP, UDP and SCTP
http://iperf.fr/

version 3.1.3
./configure --host=arm-linux-gnueabihf CFLAGS=-static CXXFLAGS=-static

version 2.0.5
./configure --build=arm-linux-gnueabihf CFLAGS=-static  CXXFLAGS=-static ac_cv_func_malloc_0_nonnull=yes


iperf -t [period] -c 192.168.1.2 -f M -i 1 -x CSV

ethtool

# cat /sys/class/net/eth0/speed



[ 4170.586602] stmmaceth ff702000.ethernet eth0: Link is n
[ 4170.608644] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
[ 4172.586666] stmmaceth ff702000.ethernet eth0: Link is Up - 1Gbps/Full - flowx
[ 4172.595841] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready

http://lkml.iu.edu/hypermail/linux/kernel/1702.0/02103.html

drivers/net/phy/dp83867.c | 2 +-
1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/phy/dp83867.c b/drivers/net/phy/dp83867.c
index ca1b462..c44259b 100644
--- a/drivers/net/phy/dp83867.c
+++ b/drivers/net/phy/dp83867.c
@@ -120,7 +120,7 @@ static int dp83867_of_init(struct phy_device *phydev)
int ret;

if (!of_node)
- return -ENODEV;
+ return 0;

dp83867->io_impedance = -EINVAL;

-- 


SE510 factory test code:
~/avm/f239/src/RT288x_SDK/source/user/cm/fact_test

~/avm/ec530b/factest

///////////////////////////////////////////////////////////////////////////

02/21 WED

EC530B: 
boot select 4
setenv bootargs 'console=ttyS1,115200' # no use
setenv qspiboot 'setenv bootargs console=ttyS1,115200 root=${qspiroot} ro rootfstype=${qspirootfstype};bootz ${loadaddr} - ${fdtaddr}'


///////////////////////////////////////////////////////////////////////////

02/13 TUE

SE510 
~/avm/f239/git/AVerCasterHDDuet/RT288x_SDK/source/user/cm/fact_test

VISCA
D:\avm\ec530b\factest-0.0.1

EC530B
~/avm/ec530b/git/EC530B/angstrom-build/build/tmp-angstrom_v2015_12-glibc/work/armv7at2hf-vfp-neon-angstrom-linux-gnueabi/avermedia-ec530b-cm-main/1.0-r0/git/user/factest

///////////////////////////////////////////////////////////////////////////

02/12 MON


EC530B
root/machinekit

bootargs=console=ttyS0,115200


///////////////////////////////////////////////////////////////////////////

02/02 FRI

Kocha
a003257@ubuntu:~/avm/c285/src/ap/dm365/interface/avm$
./kocha_internal.h
./kocha_commonLib.h
./kocha_primary.c
./kocha_impl.c
./kocha_debug.h
./kocha_interface.h
./avm_disk_detection.c
./avm_disk_detection.h



///////////////////////////////////////////////////////////////////////////

01/30 TUE












238a49c9127b43004a2be67df0ec721a5c775d65

edab31eafb814593a286eaa760032d6a996c3669



2278fe8918ad599952ad29ae5de13b90d98276f0






///////////////////////////////////////////////////////////////////////////

01/24 WED

========================================================================
Audio input is IEC 61937 compressed audio.
layout 0, 1 source
Channel Status: 00 00 20 02 DB
AudioSampleFreq:2 ValidCh:1
========================================================================



/mnt # ./test_vi1120previu 1
./test_vi1120previu: vi ch=1: bt1120, vo: bt1120
[SAMPLE_COMM_VI_StartDev]-3665: HI_MPI_VI_SetDevAttr failed with 0xa0108003!
[SAMPLE_COMM_VI_StartBT]-135: SAMPLE_COMM_VI_StartBT: start vi dev[0] failed!
[SAMPLE_VIO_BT1120_1080P_PreView]-357: start vi failed!
[main]-500: program exit abnormally!


~ # himd.l 0x11381000
*** Board tools : ver0.0.1_20121120 *** 
[debug]: {source/utils/cmdshell.c:161}cmdstr:himd.l
====dump memory 0x11381000====
0000:  80000000 00000001 00000000 00000000
0010:  00000003 00000000 00000000 00000000
0020:  00000000 00000000 00000000 00000000
0030:  028b04f2 00100000 00000000 00000000
0040:  00000000 00000000 00000000 00000000
0050:  00000000 00000000 00000000 00000000
0060:  00000000 00000000 00000000 00000000
0070:  00000000 00000000 00000000 00000000
0080:  80000000 0437077f 00000000 00000000
0090:  96ae7400 00000000 00000780 00000080
00a0:  80000000 021b077f 00000000 00000000
00b0:  96ce1800 00000000 00000780 00000080
00c0:  00000000 00000000 00000000 00000000
00d0:  00000000 00000000 ffffffff 00000006
00e0:  0438115c 021c22b8 04380780 021c0780
00f0:  00008000 00000000 00000001 00000000
[END]








///////////////////////////////////////////////////////////////////////////

01/23 TUE



[VIU] Version: [Hi3519V101_MPP_V1.0.4.0 B040 Release], Build Time: [Nov 10 2017, 14:08:58]
Change to 
[VIU] Version: [Hi3519V101_MPP_V1.0.0.0 B010 Release], Build Time: [Nov 23 2017, 16:47:29]

///////////////////////////////////////////////////////////////////////////

01/18 THU

hi_sil9136.ko 
5: 720p@60
6: 720p50
7: 1080i@60
8: 1080i@50
9: 1080p@60
10: 1080p@50
11: 1080p@25
12: 1080p@30 (default)

///////////////////////////////////////////////////////////////////////////

01/15 MON


HI_ACODEC_TYPE_TLV320AIC31

SAMPLE_COMM_AUDIO_CreatTrdFileAo



Dave's DEMO BOARD


hisilicon # printenv
bootcmd=sf probe 0;sf read 0x82000000 0x100000 0x400000;bootm 0x82000000
bootdelay=1
baudrate=115200
ethaddr=00:00:23:34:45:66
netmask=255.255.255.0
bootfile="u-boot"
kernelfile="kernel"
rootfile="rootfs"
bootargs=mem=96M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),4M(kernel),27M(rootfs) board=imx274
serverip=10.1.9.187
ipaddr=10.1.9.177
gatewayip=10.1.9.254
stdin=serial
stdout=serial
stderr=serial
verify=n
ver=U-Boot 2010.06-dirty (Dec 14 2017 - 16:48:38)

setenv bootargs 'mem=96M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),4M(kernel),27M(rootfs) board=imx274'


/********** 1100 first boot up T533C board **********/

## Booting kernel from Legacy Image at 82000000 ...
   Image Name:   Linux-3.18.20
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    3098190 Bytes = 3 MiB
   Load Address: 80008000
   Entry Point:  80008000
   Loading Kernel Image ... OK
OK

Starting kernel ...

Booting Linux on physical CPU 0x0
Initializing cgroup subsys cpu
Linux version 3.18.20 (pub@BVT-SDK-SERVER1) (gcc version 4.9.4 20150629 (prerelease) (Hisilicon_v500_201709
22) ) #1 SMP Fri Nov 10 09:38:56 HKT 2017
CPU: ARMv7 Processor [410fc075] revision 5 (ARMv7), cr=10c5387d
CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache
Machine model: Hisilicon HI3519V101 DEMO Board
cmz zone is not set!
cma: Reserved 16 MiB at 0x83000000
Memory policy: Data cache writealloc
PERCPU: Embedded 9 pages/cpu @c2f4e000 s7424 r8192 d21248 u36864
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
Kernel command line: mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc
:1M(boot),4M(kernel),11M(rootfs)
PID hash table entries: 256 (order: -2, 1024 bytes)
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 42120K/65536K available (4327K kernel code, 200K rwdata, 1132K rodata, 224K init, 349K bss, 23416K 
reserved, 0K highmem)
Virtual kernel memory layout:
    vector  : 0xffff0000 - 0xffff1000   (   4 kB)
    fixmap  : 0xffc00000 - 0xffe00000   (2048 kB)
    vmalloc : 0xc4800000 - 0xff000000   ( 936 MB)
    lowmem  : 0xc0000000 - 0xc4000000   (  64 MB)
    pkmap   : 0xbfe00000 - 0xc0000000   (   2 MB)
    modules : 0xbf000000 - 0xbfe00000   (  14 MB)
      .text : 0xc0008000 - 0xc055d190   (5461 kB)
      .init : 0xc055e000 - 0xc0596000   ( 224 kB)
      .data : 0xc0596000 - 0xc05c83c0   ( 201 kB)
       .bss : 0xc05c83c0 - 0xc061fa7c   ( 350 kB)
SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1
Hierarchical RCU implementation.
        RCU restricting CPUs from NR_CPUS=4 to nr_cpu_ids=2.
RCU: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=2
NR_IRQS:16 nr_irqs:16 16
Architected cp15 timer(s) running at 24.00MHz (phys).
sched_clock: 56 bits at 24MHz, resolution 41ns, wraps every 2863311519744ns
Switching to timer-based delay loop, resolution 41ns
Console: colour dummy device 80x30
Calibrating delay loop (skipped), value calculated using timer frequency.. 48.00 BogoMIPS (lpj=240000)
pid_max: default: 32768 minimum: 301
Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
CPU: Testing write buffer coherency: ok
CPU0: thread -1, cpu 0, socket 0, mpidr 80000000
Setting up static identity map for 0x80421be8 - 0x80421c40
ARM CCI driver probed
CPU1: Booted secondary processor
CPU1: thread -1, cpu 0, socket 1, mpidr 80000100
Brought up 2 CPUs
SMP: Total of 2 processors activated (96.00 BogoMIPS).
CPU: All CPU(s) started in SVC mode.
devtmpfs: initialized
VFP support v0.3: implementor 41 architecture 2 part 30 variant 7 rev 5
regulator-dummy: no parameters
NET: Registered protocol family 16
DMA: preallocated 256 KiB pool for atomic coherent allocations
cpuidle: using governor ladder
cpuidle: using governor menu
Serial: AMBA PL011 UART driver
12100000.uart: ttyAMA0 at MMIO 0x12100000 (irq = 36, base_baud = 0) is a PL011 rev2
console [ttyAMA0] enabled
SCSI subsystem initialized
ssp-pl022 12120000.spi: ARM PL022 driver, device ID: 0x00800022
ssp-pl022 12120000.spi: mapped registers from 0x12120000 to fea20000
ssp-pl022 12121000.spi: ARM PL022 driver, device ID: 0x00800022
ssp-pl022 12121000.spi: mapped registers from 0x12121000 to fea21000
ssp-pl022 12122000.spi: ARM PL022 driver, device ID: 0x00800022
ssp-pl022 12122000.spi: mapped registers from 0x12122000 to fea22000
ssp-pl022 12123000.spi: ARM PL022 driver, device ID: 0x00800022
ssp-pl022 12123000.spi: mapped registers from 0x12123000 to fea23000
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
Switched to clocksource arch_sys_counter
NET: Registered protocol family 2
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 1024 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP: reno registered
UDP hash table entries: 256 (order: 1, 8192 bytes)
UDP-Lite hash table entries: 256 (order: 1, 8192 bytes)
NET: Registered protocol family 1
RPC: Registered named UNIX socket transport module.
RPC: Registered udp transport module.
RPC: Registered tcp transport module.
RPC: Registered tcp NFSv4.1 backchannel transport module.
futex hash table entries: 512 (order: 3, 32768 bytes)
jffs2: version 2.2. (NAND) �© 2001-2006 Red Hat, Inc.
msgmni has been set to 82
Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254)
io scheduler noop registered
io scheduler deadline registered (default)
io scheduler cfq registered
pl061_gpio 12140000.gpio_chip: PL061 GPIO chip @0x12140000 registered
pl061_gpio 12141000.gpio_chip: PL061 GPIO chip @0x12141000 registered
pl061_gpio 12142000.gpio_chip: PL061 GPIO chip @0x12142000 registered
pl061_gpio 12143000.gpio_chip: PL061 GPIO chip @0x12143000 registered
pl061_gpio 12144000.gpio_chip: PL061 GPIO chip @0x12144000 registered
pl061_gpio 12145000.gpio_chip: PL061 GPIO chip @0x12145000 registered
pl061_gpio 12146000.gpio_chip: PL061 GPIO chip @0x12146000 registered
pl061_gpio 12147000.gpio_chip: PL061 GPIO chip @0x12147000 registered
pl061_gpio 12148000.gpio_chip: PL061 GPIO chip @0x12148000 registered
pl061_gpio 12149000.gpio_chip: PL061 GPIO chip @0x12149000 registered
pl061_gpio 1214a000.gpio_chip: PL061 GPIO chip @0x1214a000 registered
pl061_gpio 1214b000.gpio_chip: PL061 GPIO chip @0x1214b000 registered
pl061_gpio 1214c000.gpio_chip: PL061 GPIO chip @0x1214c000 registered
pl061_gpio 1214d000.gpio_chip: PL061 GPIO chip @0x1214d000 registered
pl061_gpio 1214e000.gpio_chip: PL061 GPIO chip @0x1214e000 registered
pl061_gpio 12150000.gpio_chip: PL061 GPIO chip @0x12150000 registered
brd: module loaded
hisi-sfc hisi_spi_nor.0: all blocks is unlocked.
hisi-sfc hisi_spi_nor.0: w25q256 (32768 Kbytes)
3 cmdlinepart partitions found on MTD device hi_sfc
3 cmdlinepart partitions found on MTD device hi_sfc
Creating 3 MTD partitions on "hi_sfc":
0x000000000000-0x000000100000 : "boot"
0x000000100000-0x000000500000 : "kernel"
0x000000500000-0x000001000000 : "rootfs"
SPI Nand ID Table Version 2.4
Cannot found a valid SPI Nand Device
libphy: hisi_gemac_mii_bus: probed
hi_gmac_v200 10050000.ethernet (unnamed net_device) (uninitialized): using random MAC address 0e:a2:14:b0:b
b:fe
attached PHY 1 to driver Generic PHY, PHY_ID=0x1cc916
higmac: ETH MAC supporte CCI.
Higmac dma_sg_phy: 0x82ac0000
ETH: rgmii, phy_addr=1
xhci-hcd 10180000.xhci: xHCI Host Controller
xhci-hcd 10180000.xhci: new USB bus registered, assigned bus number 1
xhci-hcd 10180000.xhci: irq 54, io mem 0x10180000
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
xhci-hcd 10180000.xhci: xHCI Host Controller
xhci-hcd 10180000.xhci: new USB bus registered, assigned bus number 2
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 1 port detected
ehci_hcd: USB 2.0 'Enhanced' Host Controller (EHCI) Driver
ehci-platform: EHCI generic platform driver
ehci-platform 10120000.ehci: EHCI Host Controller
ehci-platform 10120000.ehci: new USB bus registered, assigned bus number 3
ehci-platform 10120000.ehci: irq 51, io mem 0x10120000
ehci-platform 10120000.ehci: USB 2.0 started, EHCI 1.00
hub 3-0:1.0: USB hub found
hub 3-0:1.0: 1 port detected
ohci_hcd: USB 1.1 'Open' Host Controller (OHCI) Driver
ohci-platform: OHCI generic platform driver
ohci-platform 10110000.ohci: Generic Platform OHCI controller
ohci-platform 10110000.ohci: new USB bus registered, assigned bus number 4
ohci-platform 10110000.ohci: irq 52, io mem 0x10110000
hub 4-0:1.0: USB hub found
hub 4-0:1.0: 1 port detected
usbcore: registered new interface driver usb-storage
mousedev: PS/2 mouse device common for all mice
i2c /dev entries driver
hisi-i2c-v110 12110000.i2c: HISILICON I2C V110 bus driver
hisi-i2c-v110 12110000.i2c: mapped registers from 0x12110000 to 0xfea10000
hisi-i2c-v110 12111000.i2c: HISILICON I2C V110 bus driver
hisi-i2c-v110 12111000.i2c: mapped registers from 0x12111000 to 0xfea11000
hisi-i2c-v110 12112000.i2c: HISILICON I2C V110 bus driver
hisi-i2c-v110 12112000.i2c: mapped registers from 0x12112000 to 0xfea12000
hisi-i2c-v110 12113000.i2c: HISILICON I2C V110 bus driver
hisi-i2c-v110 12113000.i2c: mapped registers from 0x12113000 to 0xfea13000
CPUidle for CPU1 registered
himci: mmc host probe
himci: mmc host probe
usb 3-1: new high-speed USB device number 2 using ehci-platform
hub 3-1:1.0: USB hub found
hub 3-1:1.0: 2 ports detected
himci: mmc host probe
usbcore: registered new interface driver usbhid
usbhid: USB HID core driver
TCP: cubic registered
NET: Registered protocol family 10
NET: Registered protocol family 17
Registering SWP/SWPB emulation handler
usb 3-1.2: new high-speed USB device number 3 using ehci-platform
VFS: Mounted root (jffs2 filesystem) on device 31:2.
devtmpfs: mounted
Freeing unused kernel memory: 224K (c055e000 - c0596000)
random: init urandom read with 1 bits of entropy available

            _ _ _ _ _ _ _ _ _ _ _ _
            \  _  _   _  _ _ ___
            / /__/ \ |_/
           / __   /  -  _ ___
          / /  / /  / /
  _ _ _ _/ /  /  \_/  \_ ______
___________\___\__________________

[RCS]: /etc/init.d/S00devs
mknod: /dev/console: File exists
mknod: /dev/ttyAMA0: File exists
mknod: /dev/null: File exists
[RCS]: /etc/init.d/S01udev
udev[68]: starting version 167
[RCS]: /etc/init.d/S80network
[RCS]: /etc/init.d/S90hibernate
Auto login as root ...
Jan  1 00:00:03 login[115]: root login on 'ttyS000'
Welcome to HiLinux.
None of nfsroot found in cmdline.




mount -t nfs -o nolock 192.168.0.101:/nfsshare /mnt





///////////////////////////////////////////////////////////////////////////

01/05 FRI

HiMPP IPC V3.0 Media Processing Software Development Reference page 5-1 VPSS device:

"The VPSS provides a maximum of VPSS_MAX_GRP_NUM availble groups. The used chip determines the maximum number of groups. The VPSS 
is multiplexed by various groups in time division multiplexing (TDM) mode.
Each group has multiple channels."

"The VPSS group channels are classified into physical channels and extended channels."

"STICHING BLENDING"
In offline mode, two pictures from one group can be stiching-blended together.


///////////////////////////////////////////////////////////////////////////

01/04 THU

HiMPP IPC V3.0 Media Processing Software Development Reference page 3-4 VI Device: 

"Hi3519V101 supports two VI devices: Dev0 and Dev1. The two devices are independent of
each other. According to the logic, Dev0 is bound to Chn0 and Dev1 is bound to Chn1."
Physical VI Channels

"Hi3159V101 VIU provides two physical VI channels: Chn0 and Chn1. There is no secondary
channel, and extended channels are suppported."

"Extended VI channels are used to scale pictures, and their data source is the physical VI
channel. Hi3519V101 supports a maximum of 16 extended channels."



///////////////////////////////////////////////////////////////////////////

01/02 TUE

Google: advantiv software documents for video interface products
https://ez.analog.com/docs/DOC-8566

Q: sample_venc.c Usage. DONT QUITE UNDERSTAND!
NormalP -> SAMPLE_VENC_NORMALP_CLASSIC() H.265@4k@30fps+H.264@1080p@30fps
SMARTP H.265@4k@30fps+H.264@1080p@30fps
DUALP H.265@1080p@30fps+H.264@1080p@30fps
BIPREDB H.265@1080p@30fps+H.264@1080p@30fps
BgModel, frame structure in SMARTP mode
DUALP2 /case 5 / H.265@(SPInterval=0)+H.265@(SPInterval!=0)
IntraRefresh
MJPEG
low delay encode
roi background framerate
svc-t H264
Thumbnail of 1080p jpeg
A: Selections 0~3 setup GOP modle. 

* Hi3519V101 supports VENC2 module.
. receiving channel submodule
. encoding channel
. region module
. input picture size > encoding channel size : zoom out/shrink
. input picture size < encoding channel size : discard/no zoom in
. input picture size = encoding channel size : encoding

RC: rate control

CBR: constant bitrate within the bitrate statistical time

LCU
. H265 64x64
. H264 16x16
. 5 GOP modes
	.NORMALP
	.DUALP
	.SMARTP
	.BIPREDB
	x LOWDELAYB


SAMPLE_COMM_VENC_StartGetStream ->
SAMPLE_COMM_VENC_GetVencStreamProc : a thread to get from encoder and save to a file


///////////////////////////////////////////////////////////////////////////

12/29 FRI

Q: HOW TO DEAL WITH ADV7842, ADV7604 LIBS SHARING THE SAME NAME SPACE?

#define RX_NUM_OF_DEVICES



///////////////////////////////////////////////////////////////////////////

12/28 THU


TODO
----
Q: PORT THE WHOLE 7604 CODE TO HI3519
	add to git
	go through lib process again
XQ: Kyle email AM 9:46
 


SUMMARY
-------
Q: IS THERE ANY ADI RECEIVER BOARD AVAILABLE FOR TEST?
A: two. 7619+7511 at Tommy's; 7612+7513 available. No 7604 or 7842 EVM on the list.






///////////////////////////////////////////////////////////////////////////

12/27 WED

Aimed at porting ADV7842. Quite in vain.

The reason that I must use the whole package of code:
1. Not just HDMI as inputs. 
2. Too many codes. I probably can not win over the ref code in a short time.


///////////////////////////////////////////////////////////////////////////

12/26 TUE

$ make
../../component/vdec/lib/libadv7604-rel1.55.2.1.a(rx_3g_hdmi_hal.o): In function `HAL_RxAssertHpd':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7604/RX/HAL/3G/rx_3g_hdmi_hal.c:376: undefined reference to `HAL_AssertHPD'

../../component/vdec/lib/libadv7604-rel1.55.2.1.a(rx_3g_hdmi_hal.o): In function `HAL_RxIsHpdOn':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7604/RX/HAL/3G/rx_3g_hdmi_hal.c:396: undefined reference to `HAL_IsHPDOn'

../../component/vdec/lib/libadv7604-rel1.55.2.1.a(rx_3g_hdmi_hal.o): In function `HAL_RxSetBksvListReadyBit':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7604/RX/HAL/3G/rx_3g_hdmi_hal.c:435: undefined reference to `HAL_GetCurrentMsCount'

../../component/vdec/lib/libadv7604-rel1.55.2.1.a(rx_3g_hdmi_hal.o): In function `HAL_RxIntPending':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7604/RX/HAL/3G/rx_3g_hdmi_hal.c:480: undefined reference to `HAL_RxInt2Pending'
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7604/RX/HAL/3G/rx_3g_hdmi_hal.c:476: undefined reference to `HAL_RxInt1Pending'
collect2: error: ld returned 1 exit status

/home/a003257/avm/t533c/T533C_40/mpp_big-little/sample/test_1vi1120/../Make.linux:10: recipe for target 'test_1vi1120' failed
make: *** [test_1vi1120] Error 1














///////////////////////////////////////////////////////////////////////////

12/25 MON

TODO: How to roll back a certain files to previous GIT status?

TODO: #18173 one BT1120 input, along with ADV7842/ADV7604 control.

TODO: How did tlv320aic31.ko depend on media driver on HiSilicon platform?

TODO: What is the difference between a preview and a true capture from vi to vo?

HiMPP: Media Processing Platform
MPI: Media Programming interface
Capturing of input videos
H.264/265, MJPEG, JPEG, MPEG4 encodin
H264, MPEG4, MPEG2 decoding
Displaying of output video
Video and picutre pre-processing, Noise reduction, image enhancement, sharpening, deinterlacing
OSD overlaying for encoded streams
video detection and analysis
intelligence analysis
audio capturing and output
audio encoding and decoding
+----+--------+
|MPP |        |
+----+ Driver |
|OSAL|        |
+----+--------+
|    OS       |
+-------------+

$ make
../../component/vdec/lib/libhal-adv7842-rel1.55.2.1.a(rx_hdmi_hal.o): In function `NoPacketHandling':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7842/RX/HAL/rx_hdmi_hal.c:936: undefined reference to `ADIAPI_RxHdmiGetPacket'

../../component/vdec/lib/libhal-adv7842-rel1.55.2.1.a(rx_hdmi_hal.o): In function `HAL_RxHdmiHouseKeeping':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7842/RX/HAL/rx_hdmi_hal.c:693: undefined reference to `ADIAPI_RxHdmiGetAudioChanStatus'

/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7842/RX/HAL/rx_hdmi_hal.c:679: undefined reference to `ADIAPI_RxHdmiGetDstMode'

../../component/vdec/lib/libhal-adv7842-rel1.55.2.1.a(7844_hal.o): In function `HAL_RxSdpHouseKeeping':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7842/RX/HAL/4G/ADV7842/HAL/7844_hal.c:2242: undefined reference to `ADIAPI_RxSdpGetAutoFormatDetectResult'
../../component/vdec/lib/libhal-adv7842-rel1.55.2.1.a(7844_hal.o): In function `HAL_CpSet861RecSettings':
/home/a003257/avm/t533c/T533C_40/mpp_big-little/component/vdec/lib_adv7842/RX/HAL/4G/ADV7842/HAL/7844_hal.c:3407: undefined reference to `CeaVsyncPol'
../../component/vdec/lib/libhal-adv7842-rel1.55.2.1.a(7844_hal.o): In function `HAL_RxCpHouseKeeping':


///////////////////////////////////////////////////////////////////////////

12/22 FRI



Cerbero build system used to build the official upstream GStreamer 1.0 SDK binaries
a003257@ubuntu:~/avm/other_rds$ git clone git://anongit.freedesktop.org/gstreamer/cerbero



WARNING: No bootstrapper for the distro version none_uclibc
WARNING: No bootstrapper for the distro version ubuntu_xenial
=> DON'T USE UBUNTU 16.04. USE 14.04 INSTEAD.


Worked on gstreamer official cerbero. Fail a lot! Building the official release 
was not quite smooth. Lots of errors. Mainly different selections.






///////////////////////////////////////////////////////////////////////////

12/21 THU

TODO: TLV320AIC3101 driver fail to insert the first time into the kernel.
How come the 2nd module insertion 

REDMINE #17609 OK

TODO: How to switch between MIPI and VI0_DATA in VICAP?
It seems taking no setting to do so. See Hi3159V101_PINOUT_EN.xlsx. Tab "1. Pin Information". There is only "Function 0" avaiable.

vio/sample_vio.c:2302: SAMPLE_VI_MODE_BT1120_1080P


///////////////////////////////////////////////////////////////////////////

12/20 WED

TODO: Why SD is even shorter than BCLK? Almost no data? Why?
TODO: Why MCLK is pull to ground when connected to J5.17 of TLV320AIC3101?




TLV320AIC3101x: enhanced AIC31 with speaker amps


Example:
/path/to/scriptname opt1 opt2 opt3 opt4
$# ：代表scriptname後接的參數『個數』,上例為『 4 』
"$@" ：代表『 "$1" "$2" "$3" "$4" 』之意，每個變數是獨立的(用雙引號括起來)；



$ diff -c pinmux.sh ~/avm/t533c/T533C_40/mpp_big-little/ko/pinmux.sh 
*** pinmux.sh	2017-12-20 16:51:44.439033768 +0800
--- /home/a003257/avm/t533c/T533C_40/mpp_big-little/ko/pinmux.sh	2017-11-29 13:29:16.309338634 +0800
***************
*** 425,428 ****
  fi
  
  #i2c2_pin_mux;
! i2s_pin_mux;
--- 425,428 ----
  fi
  
  #i2c2_pin_mux;
! #i2s_pin_mux;

$ diff -c sysctl.sh ~/avm/t533c/T533C_40/mpp_big-little/ko/sysctl.sh 
*** sysctl.sh	2017-12-20 16:42:40.072288263 +0800
--- /home/a003257/avm/t533c/T533C_40/mpp_big-little/ko/sysctl.sh	2017-11-29 13:29:16.309338634 +0800
***************
*** 63,70 ****
  #########################################################################################
  
  
! #himm  0x120300e0 0xd				# internal codec: AIO MCLK out, CODEC AIO TX MCLK 
! himm 0x120300e0 0xe				# external codec: AIC31 AIO MCLK out, CODEC AIO TX MCLK
  
  # mddrc pri&timeout setting
  #himm 0x12060204 0x76543210     # ports0         
--- 63,70 ----
  #########################################################################################
  
  
! himm  0x120300e0 0xd				# internal codec: AIO MCLK out, CODEC AIO TX MCLK 
! #himm 0x120300e0 0xe				# external codec: AIC31 AIO MCLK out, CODEC AIO TX MCLK
  
  # mddrc pri&timeout setting
  #himm 0x12060204 0x76543210     # ports0   


RUN 
# load3519V101 -i
# insmod extdrv/hi_tlv320aic31.ko

//driver init
> d

p0    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 00 00 aa 10 04 00 00 0a f0 07
010: 00 01 50 00 80 00 00 0f f0 04
020: 78 78 04 78 78 46 00 fe 00 00
030: fe 00 00 00 00 00 44 c0 3e 00
040: 00 01 78 00 00 00 00 80 00 00
050: 00 04 00 00 00 00 00 00 04 00
060: 00 00 00 00 80 04 00 00 00 00
070: 00 00 04 00 00 00 00 00 00 00
080: 00 00 00 00 00 00 00 00 00 00
090: 00 00 00 00 c0 00 00 00 00 00
100: 00 00 32 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00

p1    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 01 6b e3 96 66 67 5d 6b e3 96
010: 66 67 5d 7d 83 84 ee 7d 83 84
020: ee 39 55 f3 2d 53 7e 6b e3 96
030: 66 67 5d 6b e3 96 66 67 5d 7d
040: 83 84 ee 7d 83 84 ee 39 55 f3
050: 2d 53 7e 7f ff 00 00 00 00 00
060: 00 00 00 00 00 7f ea 80 16 7f
070: d5 7f ea 80 16 7f d5 00 00 00
080: 00 00 00 00 00 00 00 00 00 00
090: 00 00 00 00 00 00 00 00 00 00
100: 00 00 00 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00




//MY INIT on EC530B
> i
init AIC3101
EE_HEADPHONE_VOLUME: 50
> d

p0    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 00 00 00 81 20 1e 00 0a 00 20
010: 00 01 00 00 00 28 28 0f f0 45
020: 78 78 45 78 78 86 00 00 00 00
030: 00 00 00 00 00 00 44 c0 00 00
040: 01 00 78 00 00 00 00 bc 00 00
050: 00 1f 2f 00 00 00 00 00 06 00
060: 00 00 00 2f bc 1f 00 00 00 00
070: 00 00 06 00 00 00 00 00 00 00
080: 00 00 00 00 00 00 00 00 00 00
090: 00 00 00 00 c6 0c 00 00 00 00
100: 00 00 00 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00

p1    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 01 6b e3 96 66 67 5d 6b e3 96
010: 66 67 5d 7d 83 84 ee 7d 83 84
020: ee 39 55 f3 2d 53 7e 6b e3 96
030: 66 67 5d 6b e3 96 66 67 5d 7d
040: 83 84 ee 7d 83 84 ee 39 55 f3
050: 2d 53 7e 7f ff 00 00 00 00 00
060: 00 00 00 00 00 7f ea 80 16 7f
070: d5 7f ea 80 16 7f d5 00 00 00
080: 00 00 00 00 00 00 00 00 00 00
090: 00 00 00 00 00 00 00 00 00 00
100: 00 00 00 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00


//AFTER application is running
p0    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 00 00 00 81 20 00 00 8a 20 07
010: 00 01 50 00 80 00 00 0f f0 04
020: 78 78 04 78 78 46 00 fe 00 00
030: fe 00 00 00 00 00 44 c0 3e 00
040: 00 01 78 00 00 00 00 80 00 00
050: 00 9f 00 00 00 00 00 00 06 00
060: 00 00 00 00 80 9f 00 00 00 00
070: 00 00 04 00 00 00 00 00 00 00
080: 00 00 80 00 00 00 0b 00 00 00
090: 00 00 80 0b de 28 20 20 00 00
100: 00 00 c2 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00

p1    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 01 6b e3 96 66 67 5d 6b e3 96
010: 66 67 5d 7d 83 84 ee 7d 83 84
020: ee 39 55 f3 2d 53 7e 6b e3 96
030: 66 67 5d 6b e3 96 66 67 5d 7d
040: 83 84 ee 7d 83 84 ee 39 55 f3
050: 2d 53 7e 7f ff 00 00 00 00 00
060: 00 00 00 00 00 7f ea 80 16 7f
070: d5 7f ea 80 16 7f d5 00 00 00
080: 00 00 00 00 00 00 00 00 00 00
090: 00 00 00 00 00 00 00 00 00 00
100: 00 00 00 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00


///////////////////////////////////////////////////////////////////////////

12/19 TUE

TLV320AIC3101EVM
J5A.3 BCLK
J5A.7 WCLK
J5A.11 DIN
J5A.13 DOUT
J5A.17 MCLK

After inserting extdrv/hi_tlv320aic31.ko
J5A.3 BCLK >> output signal
J5A.7 WCLK >> output signal
J5A.11 DIN
J5A.17 MCLK >> output signal

After running test_ao:
J5A.17 MCLK >> output singal, but not the other pins

Q: How to tune register values? 
	himm
	himd : memory dump
	himc : memory clear
	
AIAO registers 0x1108_0000
I2S_CRG_CFG1_00 

/mnt # himd 0x12040000
*** Board tools : ver0.0.1_20121120 ***
[debug]: {source/utils/cmdshell.c:161}cmdstr:himd
====dump memory 0X12040000====
00000:  01 00 00 00 01 00 00 00 01 00 00 00 00 00 00 00  |................|
00010:  02 00 00 00 02 00 00 00 00 00 00 00 00 00 00 00  |................|
00020:  00 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00  |................|
00030:  01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00  |................|
00040:  01 00 00 00 01 00 00 00 01 00 00 00 02 00 00 00  |................|
00050:  02 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00  |................|
00060:  01 00 00 00 02 00 00 00 02 00 00 00 02 00 00 00  |................|
00070:  02 00 00 00 02 00 00 00 00 00 00 00 00 00 00 00  |................|
00080:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  |................|
00090:  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  |................|
000a0:  00 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00  |................|
000b0:  01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00  |................|
000c0:  01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00  |................|
000d0:  01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00  |................|
000e0:  01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00  |................|
000f0:  01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00  |................|
[END]

ko/pinmux.sh

sample/audio/tlv320aic31_readme.txt


///////////////////////////////////////////////////////////////////////////

12/18 MON

Q: How to make Hi3519 send out audio via i2s?

HI_ACODEC_TYPE_TLV320AIC31
HI_ACODEC_TYPE_INNER


NOTICE: in mpp_big-little, Makefile has included 
-DSNS_IMX274_8M_SINGLE -DHI_MIPI_ENABLE as defaults

Q: could TLV320AIC31 module be successfully inserted?

$ make ACODEC_TYPE=ACODEC_TYPE_TLV320AIC31

load3519v101 was not automatically inserting extdrv/hi_tlv320aic31.ko

/mnt/ko # insmod extdrv/hi_tlv320aic31.ko
load tlv320aic31.ko for Hi35xx ok!

$ modinfo hi_tlv320aic31.ko
filename:       /nfsshare/ko/extdrv/hi_tlv320aic31.ko
author:         Hisilicon
license:        GPL
depends:        
vermagic:       3.18.20 SMP mod_unload ARMv7 p2v8 
parm:           chip_count:the num we device uses the tlv320aic31,default 1

Q: Why inserting hi_tlv320aic31.ko -> fail, the kernel would crash during trying again?


/mnt # ./aic3x 2
        --- usage ---
        i: init
        r reg: read reg(in decimal)
        w reg val: write reg(in decimal) val(in hex)
        d: dump reg values
        q: quit debugging
> d

p0    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 00 00 aa 10 04 00 00 0a f0 07
010: 00 41 50 00 80 00 00 0f f0 04
020: 78 78 04 78 78 46 00 fe 00 00
030: fe 00 00 00 00 00 cc c0 3e 00
040: 00 01 78 00 00 00 00 80 00 00
050: 00 04 00 00 00 00 00 00 04 00
060: 00 00 00 00 80 04 00 00 00 00
070: 00 00 04 00 00 00 00 00 00 00
080: 00 00 00 00 00 00 00 00 00 00
090: 00 00 00 00 c0 00 00 00 00 00
100: 00 00 32 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00

p1    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 01 6b e3 96 66 67 5d 6b e3 96
010: 66 67 5d 7d 83 84 ee 7d 83 84
020: ee 39 55 f3 2d 53 7e 6b e3 96
030: 66 67 5d 6b e3 96 66 67 5d 7d
040: 83 84 ee 7d 83 84 ee 39 55 f3
050: 2d 53 7e 7f ff 00 00 00 00 00
060: 00 00 00 00 00 7f ea 80 16 7f
070: d5 7f ea 80 16 7f d5 00 00 00
080: 00 00 00 00 00 00 00 00 00 00
090: 00 00 00 00 00 00 00 00 00 00
100: 00 00 00 00 00 00 00 00 00 00
110: 00 00 00 00 00 00 00 00 00 00
120: 00 00 00 00 00 00 00 00
>





hi_type.h
	HI_FALSE = 0,
	HI_TRUE = 1,


Set aic31 ok: bMaster = 0, enWorkmode = 0, enSamplerate = 44100

AIO_MODE_I2S_MASTER = 0,
AIO_MODE_I2S_SLAVE = 1


./pinmux_t533c.sh -vo BT1120



///////////////////////////////////////////////////////////////////////////

12/15 FRI


osdrv/tools/board/reg-tools-1.0.0/source/tools/btools.c:91:    printf("*** Board tools : %s *** \n",BTOOLS_VERSION);

source/tools/i2c_ops.c:318:	printf("i2c_num:0x%x, dev_addr:0x%x; reg_addr:0x%x; data:0x%x; reg_width: %d; data_width: %d.\n",
./source/tools/i2c_ops.c:319:			i2c_num, dev_addr << 1, reg_addr, data, reg_width, data_width);



Header files in the Linux kernel are used for two purposes: to define interfaces between components of the kernel, and to define interfaces between the kernel and user space. 

Interfaces open to internal modules are defined in the global header space, linux/include/ or linux/arch/*/include/. Interfaces among source files in a single module should be put into the same directory as parts of the module source code. Putting those locally used interfaces would pollute the global header space. 

Building external modules now requires the Makefile to point to /lib/modules/${kver}/build, where ${kver} can be the exact version string of the kernel got from command 'uname -r'.

The correct way to address this problem is to isolate the specific interfaces that you need, e.g. a single header file that is patched in a new kernel providing the ioctl numbers for a character device used by your program.

http://kernelnewbies.org/KernelHeaders



0x20: 0x0
0x21: 0x0
0x22: 0x0
0x23: 0x0
0x24: 0x44
0x25: 0xc0
0x26: 0x0
0x27: 0x0
0x28: 0x1
0x29: 0x0
0x2a: 0x0
0x2b: 0x0
0x2c: 0x0
0x2d: 0x0
0x2e: 0x0
0x2f: 0xbc
0x30: 0x0
0x31: 0x0
0x32: 0x0
0x33: 0x1f
0x34: 0x2f
0x35: 0x0
0x36: 0x0
0x37: 0x0
0x38: 0x0
0x39: 0x0
0x3a: 0x6
0x3b: 0x0
0x3c: 0x0
0x3d: 0x0
0x3e: 0x0
0x3f: 0x2f
0x40: 0xbc



p0    0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F
-----------------------------------------------------
000: 00 00 00 81 20 1e 00 0a 00 20 00 41 00 00 00 28
010: 28 0f f0 45 78 78 45 78 78 86 00 00 00 00 00 00
020: 00 00 00 00 44 c0 00 00 01 00 00 00 00 00 00 bc
030: 00 00 00 1f 2f 00 00 00 00 00 06 00 00 00 00 2f
040: bc 1f 00 00 00 00 00 00 06 00 00 00 00 00 00 00
050: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 c6 0c
060: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
070: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

p1    0  1  2  3  4  5  6  7  8  9
-----------------------------------
000: 01 6b e3 96 66 67 5d 6b e3 96 66 67 5d 7d 83 84
010: ee 7d 83 84 ee 39 55 f3 2d 53 7e 6b e3 96 66 67
020: 5d 6b e3 96 66 67 5d 7d 83 84 ee 7d 83 84 ee 39
030: 55 f3 2d 53 7e 7f ff 00 00 00 00 00 00 00 00 00
040: 00 7f ea 80 16 7f d5 7f ea 80 16 7f d5 00 00 00
050: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
060: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
070: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00







///////////////////////////////////////////////////////////////////////////

12/14 THU

Q: Which TLV320AIC3101EVM can be used in the experiment?
MPD-13026 
OK: i2c_read 2 0x72 0x0 0x20
OK: i2c_read 2 0xA0 0x0 0x20

The TLV320AIC3101 responds to the I2C address of 001 1000.

# i2c_read 2 0x30 0 0x20



TIME 19:52
# /mnt/aic3x
hisi-i2c-v110 12112000.i2c: wait rx no empty abort, RI: 0x550
hisi-i2c-v110 12112000.i2c: TX_ABRT:0x1
Fail ioctl I2C_READ retval=-1

In file included from /home/a003257/avm/t533c/T533C_40/mpp_big-little/sample/aic3x/../../../osdrv/opensource/kernel/linux-3.18.y/include/uapi/linux/i2c.h:30:0,
                 from audio.c:4:
/home/a003257/avm/t533c/T533C_40/mpp_big-little/sample/aic3x/../../../osdrv/opensource/kernel/linux-3.18.y/include/uapi/linux/types.h:9:2: warning: #warning "Attempt to use kernel headers from user space, see http://kernelnewbies.org/KernelHeaders" [-Wcpp]
 #warning "Attempt to use kernel headers from user space, see http://kernelnewbies.org/KernelHeaders"
  ^


///////////////////////////////////////////////////////////////////////////

12/13 WED

TASK: complete porting ADV7604, ADV7842 and commit to joel_testcode branch.


///////////////////////////////////////////////////////////////////////////

12/12 TUE

Q: Linux kernel folder include/uapi/linux/ What use is this?
在3.7以後把很多header file移到 include/uapi或是arch/xxxx/include/uapi下
Linux kernel uapi header file by Viller Hsiao, November 21st, 2014, http://vh21.github.io/linux/2014/11/21/linux-kernel-uapi-include-file.html
The UAPI header file split, By Michael Kerrisk, July 25, 2012, https://lwn.net/Articles/507794/

The uapi folder is supposed to contain the user space API of the kernel. Then upon kernel installation, the uapi include files become the top level /usr/include/linux/ files.
https://stackoverflow.com/questions/18858190/whats-in-include-uapi-of-kernel-source-project


Linux 3.7-rc1
From: 	 	Linus Torvalds <torvalds@linux-foundation.org>
To: 	 	Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
Subject: 	 	Linux 3.7-rc1 
https://lwn.net/Articles/519762/








///////////////////////////////////////////////////////////////////////////

12/11 MON

Documentation/i2c/dev-interface
Note that only a subset of the I2C and SMBus protocols can be achieved by
the means of read() and write() calls. In particular, so-called combined
transactions (mixing read and write messages in the same transaction)
aren't supported. For this reason, this interface is almost never used by
user-space programs.

I2C Tools for Linux
https://i2c.wiki.kernel.org/index.php/I2C_Tools
https://www.kernel.org/pub/software/utils/i2c-tools/

~ # i2c_read 2 0x72 0x0 0x10
*** Board tools : ver0.0.1_20121120 ***
[debug]: {source/utils/cmdshell.c:161}cmdstr:i2c_read
i2c_num:0x2, dev_addr:0x72; reg_addr:0x0; reg_addr_end:0x20; reg_width: 1; data_width: 1.

0x0: 0x1
0x1: 0x0
0x2: 0x36
0x3: 0x91
0x4: 0x20
0x5: 0x0
0x6: 0x19
0x7: 0x64
0x8: 0x37
0x9: 0x80
0xa: 0x0
0xb: 0x1
0xc: 0x80
0xd: 0x0
0xe: 0x0
0xf: 0x4
[END]

osdrv/tools/board/reg-tools-1.0.0/source/tools/btools.c:91:    printf("*** Board tools : %s *** \n",BTOOLS_VERSION);

source/utils/cmdshell.c:161
pCmds is ""
WRITE_LOG_DEBUG();
CMD_SHELL_Run(pCmd, argc, argv);

source/tools/i2c_ops.c:200
i2c_read(int argc, char *argv[]);
include/utils/btools.h

~ # i2c_write 2 0x72 0x5 0xff
~ # i2c_read 2 0x72 0x0 0x20
0x5: 0x3
~ # i2c_write 2 0x72 0x5 0x0
~ # i2c_read 2 0x72 0x0 0x20
0x5: 0x0

实例解析linux内核I2C体系结构
时间：2016-12-30作者：华清远见
本文针对使用linux内核子系统开发
http://www.embedu.org/column/column190.htm

在linux系统下编写I2C驱动有两种方式
1. 一种是把I2C设备当作一个普通的字符设备
2. 另一种是利用linux I2C驱动体系结构来完成
	(1) 一种是利用系统给我们提供的i2c-dev.c来实现一个i2c适配器的设备文件。然后通过在应用层操作i2c适配器来控制i2c设备。
	(2) 另一种是为i2c设备，独立编写一个设备驱动。不需要使用i2c-dev.c。

i2c-dev.c并没有针对特定的设备而设计，只是提供了通用的read()、write()和ioctl()等接口，应用层可以借用这些接口访问挂接在适配器上的i2c设备的存储空间或寄存器，并控制I2C设备的工作方式。
read()、write()方法只适用用于适配器支持i2c算法的情况，而不适合适配器只支持smbus算法的情况，所以一般都不会使用i2c-dev.c的read()、write()方法。最常用的是ioctl()方法。

针对i2c的算法，需要熟悉struct i2c_rdwr_ioctl_data 、struct i2c_msg。使用的命令是I2C_RDWR。针对smbus算法，需要熟悉struct i2c_smbus_ioctl_data。使用的命令是I2C_SMBUS。
---------------------------------------------------------------------------
Q: How to port to Linux for ADI wrapper.c?

void DBG_Printf(const char *data, ...)
{
}

Read Linux Programmer's Manual "man va_start".

---------------------------------------------------------------------------
Dave's board bootloader configure:

serverip=10.1.9.187
ipaddr=10.1.9.177
gatewayip=10.1.9.254
bootargs=mem=96M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),4M(kernel),27M(rootfs) board=imx274


# ### read sii9136 on I2C2_SCL/SDA of 3519
# i2c_read 2 0x72 0x0 0x10



    configure.ac
    Makefile.am
    the documentation files such as AUTHORS, ChangeLog, COPYING, INSTALL, NEWS, README
    Makefile.am in subdirectories

To address the point of having a "ready-to-install" version brought up by Scharron, some people include a script in the project's root directory, called bootstrap or autogen.sh, that you run once when you check a fresh copy out. You can see an example in one of my projects here. For a simpler project, your autogen.sh really only needs to consist of one line:

autoreconf --install || exit 1

although some people prefer to run ./configure automatically at the end of autogen.sh.

Which files generated by Autotools should I keep in version control repository?
https://stackoverflow.com/questions/3290908/which-files-generated-by-autotools-should-i-keep-in-version-control-repository


Shebang（也称为 Hashbang）是一个由井号和叹号构成的字符序列 #! ，其出现在文本文件的第一行的前两个字符。 类 Unix 操作系统的程序载入器会分析 Shebang 后的内容，将这些内容作为解释器指令，并调用该指令，并将载有 Shebang 的文件路径作为该解释器的参数。
典型的 shebang 解释器指令：

    #!/bin/sh—使用 sh，即 Bourne shell 或其它兼容 shell 执行脚本
    #!/bin/csh—使用 csh，即 C shell 执行
    #!/usr/bin/perl -w—使用带警告的 Perl 执行
    #!/usr/bin/python -O—使用具有代码优化的 Python 执行
    #!/usr/bin/php—使用 PHP 的命令行解释器执行






///////////////////////////////////////////////////////////////////////////

12/08 FRI

Sent Jerry Hsiao an email to ask whether HiTool version relates to chip version.







///////////////////////////////////////////////////////////////////////////

12/07 THU

Q: How is ADI source code organized? How to re-write into kernel modules?

Q: Why the configure I made last night does not have a help such as the following statement?
--build=BUILD           configure for building on BUILD [BUILD=HOST]
--host=HOST             configure for HOST [guessed]
--target=TARGET         configure for TARGET [TARGET=HOST]





Autotools Tutorial, https://www.lrde.epita.fr/~adl/autotools.html

使用 GNU Libtool 创建库 by 吴小虎, https://www.ibm.com/developerworks/cn/aix/library/1007_wuxh_libtool/index.html << This article is very well written. "结合 Autoconf 和 Automake 使用 Libtool"

Library Versioning, https://autotools.io/libtool/version.html

lib_LTLIBRARIES = libtest-1.0.la
libtest_1_0_la_LDFLAGS = -version-info 0:0:0

The three numbers stand for CURRENT:REVISION:AGE
The formula for calculating the file numbers on Linux and Solaris is (C - A).(A).(R)

libfoo.so.0.0.0
an incorrect implication that the version of the shared object uses the full three components.
The version of the library is the one indicated in the DT_SONAME tag and is, generally, only one component, so in the aforementioned case, that would be libfoo.so.0. 


///////////////////////////////////////////////////////////////////////////

12/06 WED

Q: How to compile ADI source code? 


	
	

///////////////////////////////////////////////////////////////////////////

12/05 TUE

Q: Is it possble to compile ADI software package with autotools?



*** CFLAGS was changed in "/home/a003257/avm/t533c/T533C_40/drv/extdrv/adv7842/Makefile". Fix it to use ccflags-y.  Stop.

CFLAGS should be changed into EXTRA_CFLAGS.
ccflags-y += $(EXTRA_CFLAGS) $(CFLAGS)

export KBUILD_NOPEDANTIC=1


TODO: Documentation/kbuild/makefiles.txt

$ sudo echo 7 > /proc/sys/kernel/printk
bash: /proc/sys/kernel/printk: Permission denied
bash权限不够
$ sudo sh -c "echo 7 > /proc/sys/kernel/printk"

REFERENCES:
	避免’sudo echo x >’ 时’Permission denied’
	[link] http://blog.csdn.net/hejinjing_tom_com/article/details/7767127
	
source insight 3.50.0083	
SI3US-205035-36448
SI3US-466908-65897
SI3US-368932-59383
SI3US-065458-30661
SI3US-759512-70207 

$ find . -name "*" -type f -exec dos2unix {} \;



Autotools Tutorial for Beginners 
[link] http://markuskimius.wikidot.com/programming:tut:autotools/


https://www.slideshare.net/zzz00072/gnu-make-autotools-cmake?ref=https://blog.wu-boy.com/2014/09/introduction-to-gnu-make-autotools-cmake/

https://www.slideshare.net/antonywcl/gnu-build-system-52742400?qid=9f2bb907-c5d9-4e6e-8995-3d3aab1e4786&v=&b=&from_search=6

configure.ac: write on your own or auto-generate with autoscan
one each subdir:w

step 1. autoscan
step 2. mv configure.scan configure.ac




///////////////////////////////////////////////////////////////////////////

12/04 MON

Q: from the camera driver on the DMB, can I collect knowledge of V4L2 driver?

Q: How come HiSilicon is not using anything from V4L2?
in hi3519v101_big_little_defconfig
CONFIG_MEDIA_SUPPORT=m
#
# Multimedia core support
#
CONFIG_MEDIA_CAMERA_SUPPORT=y
CONFIG_VIDEO_DEV=m
CONFIG_VIDEO_V4L2=m
CONFIG_VIDEOBUF2_CORE=m
CONFIG_VIDEOBUF2_MEMOPS=m
CONFIG_VIDEOBUF2_VMALLOC=m



///////////////////////////////////////////////////////////////////////////

11/30 THU

Allwinner H6 vs. RK3288/3399 vs Amlogic S905X



HOW TO VERIFY HDMI INPUT TO HDMI OUTPUT?
-> BT1120 port is not verified yet!





///////////////////////////////////////////////////////////////////////////

11/29 WED




///////////////////////////////////////////////////////////////////////////

11/27 MON

///////////////////////////////////////////////////////////////////////////

11/24 FRI

build for x64 to cross-reference {

	~/avm/AVT_gstreamer_SDK_x64

}

./bin/gst-launch-1.0 -v filesrc location=./128_720_2M_long.ts ! avthlssink
init 


** (gst-launch-1.0:25465): CRITICAL **: gst_base_sink_init: assertion 'pad_template != NULL' failed
WARNING: erroneous pipeline: could not link filesrc0 to averhlssink0

$ ./bin/gst-inspect-1.0 avthlssink
init 


** (gst-inspect-1.0:25315): CRITICAL **: gst_base_sink_init: assertion 'pad_template != NULL' failed



///////////////////////////////////////////////////////////////////////////

11/22 WED

0910 
{
git clone ssh://a003315@CodeReview-New.avermedia.com:29418/Cross_Platform/SDK/AVT_gstreamer_sdk

arm-hisiv500-linux-uclibcgnueabi-gcc

WORKING DIRCTORY: ~/avm/other_rds/AVT_gstreamer_sdk/

./recipes/avt-plugin.recipe:8:    remotes = {'origin': 'ssh://a000000@CodeReview-New.avermedia.com:29418/Cross_Platform/SDK/avt-plugin'}

./recipes/libftl.recipe:9:    remotes = {'origin': 'ssh://a000000@CodeReview-New.avermedia.com:29418/Cross_Platform/SDK/ftl-sdk'}

./recipes/libhls.recipe:8:    remotes = {'origin': 'ssh://a000000@CodeReview-New.avermedia.com:29418/Cross_Platform/SDK/libhls'}

./recipes/libremovebg.recipe:8:    remotes = {'origin': 'ssh://a000000@CodeReview-New.avermedia.com:29418/Cross_Platform/SDK/libremovebg'}
grep: ./recipes/librsvg: Is a directory

./recipes/librtmp.recipe:9:    remotes = {'origin': 'ssh://a000000@CodeReview-New.avermedia.com:29418/Cross_Platform/SDK/librtmp'}



Build GStreamer with cerbero

$ git clone git://anongit.freedesktop.org/gstreamer/cerbero
$ ./cerbero-uninstalled -c config/xxx.cbc bootstrap

$ ./cerbero-uninstalled list # list available recipes
$ ./cerbero-uninstalled list-packages # list available packages
$ ./cerbero-uninstalled wipe # Wipes everything to restore the build system
$ ./cerbero-uninstalled bootstrap : 下载并安装当前环境下编译时所需工具
$ ./cerbero-uninstalled build <recipe> : 编译某个recipe，包括其依赖项
$ ./cerbero-uninstalled buildone <recipe> : 编译某个recipe，不包括其依赖项
$ ./cerbero-uninstalled cleanone <recipe> : 清理某个recipe


$ ./cerbero-uninstalled -c config/xxx.cbc package gstreamer-1.0


reference:
* Building from source using Cerbero [link](https://gstreamer.freedesktop.org/documentation/installing/building-from-source-using-cerbero.html)
* GStreamer SDK 1.0 Build Via Cerbero [link](http://www.jianshu.com/p/7863404c1909)

import os
from cerbero.config import Platform, Architecture, Distro, DistroVersion

target_platform = Platform.LINUX
target_distro = Distro.NONE
target_distro_version = DistroVersion.NONE_UCLIBC
target_arch = Architecture.ARM
variants = ['noalsa', 'nox11', 'nopulse', 'nocdparanoia', 'nosdl',
            'nov4l2', 'notestspackage', 'nopython']
host = 'arm-hisiv500-linux'
tool_prefix = '%s-' % host
allow_parallel_build = True



diff --git a/gstreamer_src/cerbero/recipes/glib.recipe b/gstreamer_src/cerbero/recipes/glib.recipe
index f231d6d..f87359a 100644
--- a/gstreamer_src/cerbero/recipes/glib.recipe
+++ b/gstreamer_src/cerbero/recipes/glib.recipe
@@ -138,6 +138,7 @@ class Recipe(recipe.Recipe):
             path2 = None
             use_old_uri_scheme = False
             self.configure_options += ' --disable-selinux'
+            self.configure_options += ' --with-libiconv=gnu'
             # Old Debian/Ubuntu
             if self.config.target_distro_version in [DistroVersion.DEBIAN_SQUEEZE,
                                                      DistroVersion.UBUNTU_LUCID,


Recipe 'gdk-pixbuf' failed at the build step 'compile'
Select an action to proceed:
[0] Enter the shell
[1] Rebuild the recipe from scratch
[2] Rebuild starting from the failed step
[3] Skip recipe
[4] Abort


--- test-coredump-unwind.c	2017-10-13 11:13:45.740446355 +0800
+++ build/sources/linux_arm/libunwind-1.1/tests/test-coredump-unwind.c	2017-10-13 11:16:53.104935412 +0800
@@ -57,7 +57,9 @@
 #include <grp.h>
 
 /* For SIGSEGV handler code */
+#ifndef __UCLIBC__
 #include <execinfo.h>
+#endif
 #include <sys/ucontext.h>
 
 #include <libunwind-coredump.h>
@@ -238,6 +240,7 @@
 			ip);
 
   {
+#ifndef __UCLIBC__
     /* glibc extension */
     void *array[50];
     int size;
@@ -245,6 +248,7 @@
 #ifdef __linux__
     backtrace_symbols_fd(array, size, 2);
 #endif
+#endif
   }
 
   _exit(1);


Recipe 'webrtc-audio-processing' failed at the build step 'compile'
Select an action to proceed:
[0] Enter the shell
[1] Rebuild the recipe from scratch
[2] Rebuild starting from the failed step
[3] Skip recipe
[4] Abort


Configuring included Libav instance with args --prefix=/home/a003257/avm/other_rds/AVT_gstreamer_sdk/gstreamer_src/cerbero/build/dist/linux_arm         --enable-static --enable-pic         --disable-avdevice --disable-postproc         --disable-programs --disable-ffserver --disable-ffplay --disable-ffprobe --disable-ffmpeg         --disable-encoder=flac --disable-protocols --disable-devices         --disable-network --disable-hwaccels --disable-dxva2 --disable-vdpau         --disable-filters --enable-filter=yadif --disable-doc --disable-vda --disable-d3d11va --disable-dxva2         --disable-audiotoolbox --disable-videotoolbox --disable-vaapi --disable-crystalhd         --disable-mediacodec --disable-nvenc --disable-mmal --disable-omx         --disable-omx-rpi --disable-cuda --disable-cuvid --disable-libmfx         --disable-libnpp --disable-iconv --disable-jni --enable-optimizations --enable-cross-compile         --target-os=linux-uclibcgnueabi --arch=arm --cross-prefix=arm-hisiv500-linux-uclibcgnueabi- --ar="$AR" --as="$CC" --cc="$CC" --ld="$CC" --nm="$NM" --disable-ffmpeg 
Unknown OS 'linux-uclibcgnueabi'.

If you think configure made a mistake, make sure you are using the latest
version from Git.  If the latest version fails, report the problem to the
ffmpeg-user@ffmpeg.org mailing list or IRC #ffmpeg on irc.freenode.net.
Include the log file "config.log" produced by configure as this will help
solve the problem.
config.status: error: Failed to configure embedded Libav tree

Recipe 'gst-libav-1.0' failed at the build step 'configure'

export OS=linux

./build/sources/linux_arm/gst-libav-1.0-1.12.2/ChangeLog:2990:	  configure: Chose right target-os for iOS
./build/sources/linux_arm/gst-libav-1.0-1.12.2/ChangeLog:6528:	  to parameters like --with-ffmpeg-extra-configure=" --target-os=linux
./build/sources/linux_arm/gst-libav-1.0-1.12.2/configure:18250:        --target-os=$target_os --arch=$host_cpu --cross-prefix=$host_alias-"


export GST_PLUGIN_PATH=XXX/lib/gstreamer-1.0
export LD_LIBRARY_PATH=XXX/lib


 ./bin/gst-inspect-1.0 --version
 
 gst-inspect-1.0 [OPTION] [PLUGIN|ELEMENT]
 
-a, --print-all

avthlssink-> segmentation fault

PACKED FILE: linux_arm_7112214.tar.bz2

}


Q: linux kernel module md5.ko. Can't build in 3516A?


///////////////////////////////////////////////////////////////////////////

11/21 TUE

Q (17:30)
How to enable an embedded linux board mount a remote shared folder on windows system?
for NAS
- Linux PC need to install samba-client samba-common cifs-utils to mount
q: is there a cifs.ko? Yes. 
https://www.kernel.org/doc/readme/Documentation-filesystems-cifs-README


Q (14:25)
How to build gstreamer so that the libraries can search dependencies with relative path instead of absolute path?




http://www.jianshu.com/p/7863404c1909




linux_arm_20171121_1100.tar.bz2






///////////////////////////////////////////////////////////////////////////

11/20 MON

Official cerbero of gstreamer for test build: ~/avm/t533c/tmp

https://github.com/GStreamer/gstreamer.git
https://github.com/GStreamer/cerbero.git

working directory: tmp/freedesktop/cerbero

https://github.com/flexVDI/cerbero
https://github.com/EricssonResearch/cerbero

cerbero is a build system written by GStreamer developers to build all GStreamer dependencies, GStreamer itself and package it up into nice platform-specific SDK-like binary files.


https://github.com/GStreamer/cerbero




cerbero is a multi-platform build system for Open Source projects that builds
and creates native packages for different platforms, architectures and distributions.

Projects are defined using recipes files (.recipe), which provides a description
of the project being built such as name, version, licenses, sources and the way
it's built. It also provide listing of files, which is later used for the packaging.

Packages are defined using packages files (.package), describing the package name,
version, license, maintainer and other fields used to create the packages. A
package wraps a list of recipes, from which the list of files belonging to the
package will be extracted.


HISILICON HAS ITS OWN GIT !!!
https://github.com/hisilicon

---------------------------------------------------------------------------
Traceback (most recent call last):
  File "./cerbero-uninstalled", line 8, in <module>
    from cerbero.main import main
  File "./cerbero/main.py", line 34, in <module>
    from cerbero import config, commands
  File "./cerbero/config.py", line 25, in <module>
    from cerbero.utils import _, system_info, validate_packager, to_unixpath,\
  File "./cerbero/utils/shell.py", line 41, in <module>
    PLATFORM = system_info()[0]
  File "./cerbero/utils/__init__.py", line 154, in system_info
    raise FatalError("Distribution '%s' not supported" % str(d))
cerbero.errors.FatalError: Fatal Error: Distribution '('Ubuntu', '16.04', 'xenial')' not supported
---------------------------------------------------------------------------
16.04 is not a proper os for building gstreaemr !!!


HP 6200 setup VT-x
	F10 enter BIOS
	Security->System Security
	Enable Virtualization Technology
	Save and restart
	
	
	
	


5.0.40_Ubuntu r115130
File->Preferences->Network->Host-only Networks
Add "vboxnet0"



Recompile in 14.04

Patch uclibc for compiling glib
target/usr/include/stdlib.h:621:#define mkostemp(x,y) mkstemp(x)

GIT checkout tag and then form a branch
git checkout <tag_name>
git checkout -b <branch_name>

cerbero's README file

How do I check gstreamer version?
gst-launch-1.0 --version

libtool: Version mismatch error.  This is libtool 2.4.6, but the
libtool: definition of this LT_INIT comes from libtool 2.4.2.
libtool: You should recreate aclocal.m4 with macros from libtool 2.4.6
libtool: and run autoconf again.
make[3]: *** [libgstavthlssink_la-gstavthlssink.lo] Error 63

In the root directory of where the issue happens:
~/AVT_gstreamer_SDK/gstreamer_src/cerbero/build/sources/linux_arm/avt-plugin-None$ autoreconf --force --install

$autoreconf --force --install
./configure
make

GstAppSrc — Easy way for applications to inject buffers into a pipeline

$ grep -n 'gst_app_src' *
Binary file libgstapp-1.0.a matches
Binary file libgstapp-1.0.so matches
Binary file libgstapp-1.0.so.0 matches
Binary file libgstapp-1.0.so.0.1202.0 matches
Binary file libgstbasecamerabinsrc-1.0.so matches
Binary file libgstbasecamerabinsrc-1.0.so.0 matches
Binary file libgstbasecamerabinsrc-1.0.so.0.1202.0 matches



Cross-compilation of GStreamer
https://gstreamer.freedesktop.org/documentation/installing/building-from-source-using-cerbero.html

1700 use armv7 to compile again


gst-inspect-1.0 [OPTION] [PLUGIN|ELEMENT]
-a, --print-all

Print all plugins and elements

compiling libremovebg:export CROSS_COMPILE=
compiling librtmp avt_plugin: 
export RTMP_LIBS=-L$(libdir} -lrtmp -lz 
export RTMP_CFLAGS=-I${incdir}

///////////////////////////////////////////////////////////////////////////

11/17 FRI



WORKDING DIRECTORY: ~/avm/AVT_gstreamer_SDK
BRANCH: uclibc

# config/cross-lin-hisiv500.cbc







1930: build to 30/37 ctrl-c break
todo: continue to compile to end; add base package

[(33/37) librtmp -> compile ]
[(33/37) librtmp -> install ]
[(33/37) librtmp -> post_install ]
[(34/37) curl -> fetch ]
-----> Fetching tarball https://curl.haxx.se/download/curl-7.55.1.tar.gz to /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/build/sources/local/curl-7.55.1/curl-7.55.1.tar.gz
[(34/37) curl -> extract ]
-----> Extracting tarball to /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/build/sources/linux_arm/curl-7.55.1
Unpacking /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/build/sources/local/curl-7.55.1/curl-7.55.1.tar.gz in /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/build/sources/linux_arm
[(34/37) curl -> configure ]
[(34/37) curl -> compile ]
[(34/37) curl -> install ]
[(34/37) curl -> post_install ]
[(35/37) libhls -> fetch ]
[(35/37) libhls -> extract ]
[(35/37) libhls -> configure ]
[(35/37) libhls -> compile ]
[(35/37) libhls -> install ]
[(35/37) libhls -> post_install ]
[(36/37) avt-plugin -> fetch ]
[(36/37) avt-plugin -> extract ]
[(36/37) avt-plugin -> configure ]
-----> copying /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/data/autotools/config.guess to /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/build/sources/linux_arm/avt-plugin-None/config.guess
-----> copying /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/data/autotools/config.sub to /home/a003257/avm/AVT_gstreamer_SDK/gstreamer_src/cerbero/build/sources/linux_arm/avt-plugin-None/config.sub
[(36/37) avt-plugin -> compile ]
[(36/37) avt-plugin -> install ]
[(36/37) avt-plugin -> post_install ]
WARNING: No specific packager available for the distro version none_uclibc, using generic packager for distro none
-----> Creating package for gstreamer-1.0
WARNING: Some libraries weren't found while searching!
libgstgl-1.0
WARNING: Some libraries weren't found while searching!
libwebrtc_audio_processing
WARNING: Some libraries weren't found while searching!
libgstvalidate-preload-1.0
***** Error running 'package' command:
The following files required by this package are missing:
 lib/gstreamer-1.0/libgstopengl.so
lib/gstreamer-1.0/libgstaudiovisualizers.so



///////////////////////////////////////////////////////////////////////////
11/16







avm/AVerCasterHDDuet/RT288x_SDK/source/linux-2.6.21.x/drivers/media/avermedia/f239_fmb_driver/ITE6604/hdmirx.c




http://free-electrons.com/pub/conferences/2016/elce/belloni-alsa-asoc/






https://youtu.be/kb1yAt9d2k8



1. Discoverable: for example PCI, USB
2. Non-discoverable: for example I2C, SPI

Platform devices are inherently not discoverable, i.e. the hardware cannot say “Hey! I’m present!” to the software. Unlike PCI or USB devices, I2C devices are not enumerated at the hardware level (at run time). Instead, the software must know (at compile time) which devices are connected on each I2C bus segment. So USB and PCI are not platform devices.

[link](https://kerneltweaks.wordpress.com/tag/platform-data/) Platform Device and Platform Driver @ Linux. Written in 2014, saying about drivers before device tree was invented.

The platform device API by Corbet [link](https://lwn.net/Articles/448499/)
"Platform devices and device trees" by Corbet [link](https://lwn.net/Articles/448502/)


./arch/arm/boot/dts/hisi-hi3519v101-hmp-demb.dts
./arch/arm/boot/dts/hisi-hi3519v101-demb.dts
./arch/arm/boot/dts/hisi-hi3519v101-hmp-demb.dtb
./arch/arm/boot/dts/hisi-hi3519v101.dtsi

Q: hisi-hi3519v101-demb.dts and hisi-hi3519v101-hmp-demb.dts - which is in use? [solved]
Q: Which device tree is the Hi3519V101 demo board using? [solved]
	./arch/arm/boot/dts/hisi-hi3519v101-hmp-demb.dts

Q: How is DTS compiled?
	It is compiled along with the kernel source code.
	arch/arm/boot/dts/Makefile:97 dtb-$(CONFIG_ARCH_HI3519V101) += hisi-hi3519-hmp-demb.dtb:
	CONFIG_ARCH_HI3519V101

///////////////////////////////////////////////////////////////////////////
11/15

commit 67f05ca102686256bdcf30081621427cda577819
Author: Joel Ding <joel.ding@avermedia.com>
Date:   Wed Nov 15 17:07:36 2017 +0800

        modified:   avt_gstreamer_sdk_uclibc.tgz

Q: How are multiple audio channels arranged in I2S[0:3]?








///////////////////////////////////////////////////////////////////////////
11/14

google search: up/qup6/d9/z8/103/
found WM8731 dev board

Q: SII9136 no driver source code?
	HDMI TX example drivers/media/i2c/adv7511.c //ADV7511 HDMI TX


Device Drivers
	-> Multimedia support (MEDIA_SUPPORT [=y]) 
		-> Encoders, decoders, sensors and other helper chips


Q: How do I build a single in-tree kernel module?
	ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- make M=`pwd`/drivers/media/i2c/it6604 


Hi3519V101 i2c2 to tlv320aic3101
	disable JTAG: R72:4.7K; R74:NC 
	jump wire: R82/I2C2_SCL; R83/I2C2_SDA
	
	J15.5: I2S_MCLK (original JTAG_TCK)  R53:NC
	J15.6: I2S_SD_TX (original JTAG_TDO)  R71:NC
	J15.4: I2S_BCLK_TX (original JTAG_TMS)  R70:NC
	J15.2: I2S_WS (original JTAG_TRSTN)  R95:NC R56:NC
	J15.9: GNC
	J15.10: GND

I2S_SD_RX JTAG_TDI J15.3 R57:NC  




///////////////////////////////////////////////////////////////////////////
11/13

Q: How to revert files in a git to a certain commit?

	mpp_big-little/sample/common/sample_comm.h
	mpp_big-little/sample/common/sample_comm_audio.c
	need to be recovered

	TODO: compare with original common codes






///////////////////////////////////////////////////////////////////////////////
11/10

Usage:
  dm-tool [OPTION...] COMMAND [ARGS...] - Display Manager tool

Options:
  -h, --help        Show help options
  -v, --version     Show release version
  --session-bus     Use session D-Bus

Commands:
  switch-to-greeter                                    Switch to the greeter
  switch-to-user USERNAME [SESSION]                    Switch to a user session
  switch-to-guest [SESSION]                            Switch to a guest session
  lock                                                 Lock the current seat
  list-seats                                           List the active seats
  add-nested-seat [--fullscreen|--screen DIMENSIONS]   Start a nested display
  add-local-x-seat DISPLAY_NUMBER                      Add a local X seat
  add-seat TYPE [NAME=VALUE...]                        Add a dynamic seat



  * cross compile alsa utils
./configure --host=arm-hisiv500-linux 
--disable-python \
--prefix=/mnt/alsa_install \
--with-alsa-inc-prefix=/nfsshare/mnt/alsa_install/include \
--with-alsa-prefix=/nfsshare/mnt/alsa_install/lib \
--disable-alsamixer \
--disable-xmlto
    make; make install DESTDIR=/nfsshare

ebaina [求助] alsa-utils 和 aplay 移植到嵌入式系统 [link](http://bbs.ebaina.com/thread-3856-1-1.html)

# aplay -l
**** List of PLAYBACK Hardware Devices ****
card 0: PCH [HDA Intel PCH], device 0: ALC662 rev1 Analog [ALC662 rev1 Analog]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 0: PCH [HDA Intel PCH], device 3: HDMI 0 [HDMI 0]
  Subdevices: 1/1
  Subdevice #0: subdevice #0

# ls /dev/snd/
timer

 # cat /proc/asound/cards 
--- no soundcards ---

# cat /proc/asound/devices 
 33:        : timer

# ./aplay -l
aplay: device_list:268: no soundcards found...


[link](http://free-electrons.com/doc/legacy/audio/embedded_linux_audio.pdf)


vim zM: close all; zR: open all; 
zm: close the source file by one more level; zr: open the source file by  one more level



///////////////////////////////////////////////////////////////////////////////
11/09

# ALSA
  * Advanced Linux Sound Architecture
  * a software framework of the Linux kernel
  * provides an application programming interface (API) 
  * for sound card device drivers
  * bundles a user-space library for application developers

  * cross compile alsa lib
    ./configure --host=arm-hisiv500-linux --disable-python --prefix=/mnt/alsa_install
    make; make install DESTDIR=/nfsshare

references:
1. Advanced Linux Sound Architecture (ALSA) project homepage 
  [link](https://www.alsa-project.org/)
2. alsa-lib及alsa-utils成功移植
  [link](http://blog.sina.com.cn/s/blog_7d7e9d0f0101lqlp.html)
3. arm cross compile issue 
  [link](https://stackoverflow.com/questions/36195926/alsa-util-1-1-0-arm-cross-compile-issue)

ALSA_CONFIG_PATH



/mnt # usb 2-1: new SuperSpeed USB device number 7 using xhci-hcd
usb 2-1: LPM exit latency is zeroed, disabling LPM.
usb 2-1: Int endpoint with wBytesPerInterval of 1024 in config 1 interface 2 altsetting 0 ep 133: setting to 64
uvcvideo: Found UVC 1.00 device 1E04-INOGENI 4K2USB3 (2997:0004)
hid-generic 0003:2997:0004.0002: device has no listeners, quitting


uvcvideo: Found UVC 1.00 device AVerMedia USB Device (07ca:0110)
uvcvideo: UVC non compliance - GET_DEF(PROBE) not supported. Enabling workaround.


///////////////////////////////////////////////////////////////////////////////



一般在以下情況, 我們會進行移植 Linux Kernel 的動作.
1. 將新版 Linux Kernel 移植到全新 SoC 上
  開發人員為 SoC 廠商(e.g. MTK, TI, Allwinner) R&D engineer.
  在此階段的移植, 需要寫 dtsi, low-level code (位於 arch// 底下) 以及 SoC 相關的底層驅動程式. 並且須確保 SoC 功能運行正常.
2. 將新版 Linux Kernel 移植到全新平台上
  開發人員為硬體廠的軟體 R&D engineer, 開發板 (e.g. beagleboard, RPi) 上游開發人員或者是一些 software consultant.
  在此階段的移植, 需要建立 dts 來描述硬體資訊, 並適度修改 dtsi. 此外也需要根據硬體/ 週邊/ 平台資訊來建立屬於板子的 Kernel  config. 檔. 並且須確保硬體/ 週邊/ 平台功能運行正常.
3. 將新版 Linux Kernel 移植到舊有平台上進行 Kernel 版本升級
  開發人員為任何有興趣的 Maker. 只要有開發版即可進行 (e.g. beagleboard, RPi). 一般來說, Linux Kernel 移植大多屬於此範疇.
  在此階段的移植, 需要根據 dtsi 的版本差異來微調 dts 格式. 此外也需要根據 Kernel 版本差異資訊來微調板子的 Kernel  config. 檔.
  此外也須參照舊有 Kernel source 上的 in-house patch 來修改新版 Kernel source.
  *  另外還有像將 Linux Kernel 移植到全新 CPU architecture 上面這種較罕見的情況.

在移植 Linux Kernel 時, 最重要的第一步就是讓機器可以 ” 開機 “. Kernel 能正常開機往下執行, 我們才能進行後續移植動作.
在無法開機的情況下 (請見下圖), 由於沒有任何錯誤訊息, 所以除錯上會比較困難.
一旦可以開機, 畫面有訊息列印出來, 即便有其他問題, 相對起來也比較好解.

最常遇到開不了機的現象就是 hang 在 “Starting Kernel” 這邊.
在這個階段 bootloader 把 Linux Kernel 載入 Memory 位址 0x80008000, 並將 CPU 控制權交給 Linux Kernel. 此時理因跳轉到 Linux Kernel 第一條指令 [1], 接著 Kernel 開始自解壓縮進行後續開機流程 [2].
如果在這個階段卡住, 代表 Linux Kernel 沒有正確運行, 原因可分成下列幾點

無法開機根因 	可能發生時機 	解決方法
SoC low-level code 有問題 	將 Linux 移植到新 SoC 上 	

修改 low-level code, 並確保 SoC 裡功能可正常運行. 有可能需要在 driver 中以 work-around 手法避掉問題.
舊有 DTS 與 新板 DTSI不相容 	

將新 Linux Kernel 移植到舊有平台上進行Kernel 升級
	閱讀 dtsi git 修改歷程, 並詳細閱讀 “Documentation/devicetree/bindings/” 相關文件.
硬體設計有問題 	

    將 Linux 移植到新 SoC上
    將新 Linux Kernel 移植到全新平台上

	和 Hardware/ Bootloader 部門 R&D 工程師協同合作, 一起看硬體線路除蟲
Console port 設定錯誤 	

    將 Linux 移植到新 SoC上
    將新 Linux Kernel 移植到全新平台上
    將新 Linux Kernel 移植到舊有平台上進行Kernel 升級

	

每一塊板子的 Console port device node 都需根據硬體設計以及 driver 設計來進行設定. 如果設定錯誤, 會導致訊息出不來

一般情況下 console device node 為 ttyS0, baud: 115200
Boot code program (包含bootloader) 與 Kernel 不相容 	

    將 Linux 移植到新 SoC上
    將新 Linux Kernel 移植到全新平台上
    將新 Linux Kernel 移植到舊有平台上進行Kernel 升級

	

需確認 boot code program 版本與 Kernel 版本是相對應的. 尤其有些 SoC 的設計會有多個 boot code program.
DTB 跟 Kernel memory 位址衝突 	

    將 Linux 移植到新 SoC上
    將新 Linux Kernel 移植到全新平台上
    將新 Linux Kernel 移植到舊有平台上進行Kernel 升級

	boot code program 需要注意避免將兩者 memory 位址設太近導致衝突.
DTB 檔跟 Kernel 並不相容 	

    將 Linux 移植到新 SoC上
    將新 Linux Kernel 移植到全新平台上
    將新 Linux Kernel 移植到舊有平台上進行Kernel 升級

	記得重新編譯 Kernel 時, 也要一併重新編譯 DTB. 並確保兩者是成對的.
Kernel config 檔中的 ARCH 相關資訊設定錯誤 	

    將 Linux 移植到新 SoC上
    將新 Linux Kernel 移植到全新平台上
    將新 Linux Kernel 移植到舊有平台上進行Kernel 升級

	確定 SoC 種類, 並到Kernel 選單 –  System Type 中選取對應的選項

reference:
[1] 移植 Linux Kernel 造成無法開機之解決方案以及除錯工具[link](http://szlin.me/2017/05/17/unable-to-boot-with-linux-kernel)




///////////////////////////////////////////////////////////////////////////////

11/08

According to [2], data in a wave file are arranged by channels. For NumChannels = 2; BitsPerSample = 16 - see [1] for the definition of BitsPerSample, the data are arranged as [left channel][right channel][L][R]...
00 00 00 00 
24 17 1e f3 
3c 13 3c 14 
16 f9 18 f9 
34 e7 23 a6 
3c f2 24 f2 
11 ce 1a 0d

In wave file, no such an idea as "frames". 

References:
[1] WAVE PCM soundfile format [link](http://soundfile.sapp.org/doc/WaveFormat/)
(http://stenlyho.blogspot.tw/2015/12/audio-wave-format-specification.html)
[2] Multiple channel audio data and WAVE files [link](https://msdn.microsoft.com/en-us/library/windows/hardware/dn653308(v=vs.85).aspx)
[3] Audio File Format Specifications [link](http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/WAVE.html)








///////////////////////////////////////////////////////////////////////////////

11/07

TODO:
0.5 Trace sample_audio.c
1. Feed PCM file to memory, DMA to AIO, and then DA to output
2. Feed PCM file to memory, DMA to AIO, and I2S to HDMI TX 

* Trace option 2: read audio stream from file, decode and send to AO
* SAMPELE_AUDIO_AdecAo();
* SAMPLE_COMM_AUDIO_CfgAcodec();










///////////////////////////////////////////////////////////////////////////////

11/06

arm-hisiv500-linux-objcopy --gap-fill=0xff -O binary u-boot u-boot.bin
osdrv/tools/pc_tools/uboot_tools/
mkboot.sh reg_info.bin u-boot-hi3519v101.bin
# mw.b 0x82000000 ff 0x100000
# tftp 0x82000000 u-boot.bin
# sf probe 0
# sf erase 0x0 0x100000
# sf write 0x82000000 0x0 0x100000


Q: How can GNU toolchain relocate u-boot binary image when linking archive files?

Q: How do I know the address where u-boot stores environment parameters?

BOOT_SEL0

HiTool: using usb-to-serial is better than using on-mainboard uart port.

SW1.3 ->1 bootrom; ->0 

Q: What is the difference between PCM and I2S?
I2S:
  * 4-wire interface: bit clocke (BCLK), left/right clock (LRC), Tx, Rx lines
  * 3 operating modes: I2S, left justfied, right justfied
PCM:
  * 4-wire interface: bit clocke (BCLK), sync (SYNC), Tx, Rx lines
  * 2 operating modes: A and B

references:
1. kernel documentation on Digital Audio Interface [link](Documentation/sound/alsa/soc/DAI.txt)
2. [link](http://blog.csdn.net/azloong/article/details/6536855)


///////////////////////////////////////////////////////////////////////////////
11/03

Q: How to compile a dts file?


Q: Where Kocha code is?
  ap.git/dm365/interface/avm/kocha_*


Q: How to copy to the clipboard in OpenBox?
  Ctrl+Shift+C to copy; mouse mid-button to paste



What causes a 'dirty' revision?
references:
  [1] https://lists.denx.de/pipermail/u-boot/2008-May/034702.html


///////////////////////////////////////////////////////////////////////////////
11/02

Q: v4l2-framework.txt does not talk about video buffer. What else talks about it?

Q: How to use I2S of Si3519V101 and make HDMI out with stereo audio? (Dave)

On the chip, pins relating to I2S input and output are:
AB23: JTAG_EN

AB24: I2S_BCLK_TX
AC23: I2S_WS_TX
AD23: I2S_SD_TX

AC24: I2S_MCLK

AC22: I2S_BCLK_RX
AB21: I2S_WS_RX
AD22: I2S_SD_RX

1. Remove R74 to disable JTAG function
2. Connect to SD0/1/2/3/MCLK/SCK/WS_DR0

Q: How to select pin functions of Si3519V101 (setup pin multiplexing)?

///////////////////////////////////////////////////////////////////////////////



Q: How does a bootloader bring dtb to kernel?
bootm <address> - <>

Q: Must dtb explicitly load via u-boot bootm? This article said dtb can be integrated into uboot or separately loaded [link](http://blog.csdn.net/ooonebook/article/details/53206623)

* Device Tree
  * ARM Linux 2.6，arch/arm/plat-xxx和arch/arm/mach-xxx中充斥着描述板级细节的代码
    * 板上的platform设备、resource、i2c_board_info、spi_board_info以及各种硬件的platform_data。
  * 是一种描述硬件的数据结构
  * 画一棵电路板上CPU、总线、设备组成的树
  * 结点（node）和属性（property）组成
    * 结点本身可包含子结点
    * 属性是成对出现的name和value
  * DTS (device tree source) -> DTC (device tree compiler) -> Device Tree Blob (.dtb) 
  * bootloader将这棵树传递给内核在引导kernel的过程中，会先读取该.dtb到内存。
  * .dtsi: 提炼SoC公用的部分或者多个machine/SoC共同的部分，i代表include



references:
[1] ARM Linux 3.x的设备树（Device Tree）宋宝华 http://blog.csdn.net/21cnbao/article/details/8457546
[2] The Devicetree Specification https://www.devicetree.org/
[3] Thomas Petazzoni, Device Tree for Dummies. Presentation [link](http://free-electrons.com/pub/conferences/2013/elce/petazzoni-device-tree-dummies/petazzoni-device-tree-dummies.pdf); talk for Embedded Linux Conference Europe [link](https://youtu.be/m_NyYEBxfn8)
[4] Device Tree Usage [link](https://elinux.org/Device_Tree_Usage) 
  targeting at how to write a device tree for a new machine
[5] Kernel documentation [link](Documentation/devicetree)
[6] DeviceTree基础 [link](https://lonzoc.gitbooks.io/device-tree-guide/content/devicetree_basic.html)
///////////////////////////////////////////////////////////////////////////////










---------------------------------------------------------------------------------------

sample_tde shows a quarter sized backgroud with some pictures moving around.



---------------------------------------------------------------------------------------
Good resoures: http://free-electrons.com/doc/legacy/


-------------------------------------------------------------------------------








object檔修改工具 - objcopy


-------------------------------------------------------------------------------

## 亂序執行
* out-of-order execution
* aka: OoOE, OOE

ref
* Out-of-order execution [link](https://en.wikipedia.org/wiki/Out-of-order_execution)
* 乱序执行 [link](https://zh.wikipedia.org/wiki/%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C)

-------------------------------------------------------------------------------

ref
* http://capricorn-liver.blogspot.tw/2010/11/cbmp.html

-------------------------------------------------------------------------------
## GUID Partition Table
* aka GPT
* a part of the Unified Extensible Firmware Interface (UEFI) standard, as a replacement for the PC BIOS
* MBR (Master boot record) partitioning scheme
  * The original version of the MBR was written by David Litton of IBM in June 1982
  * introduced with IBM PC DOS 2.0 in March 1983 in order to support the 10 MB hard disk of the then-new IBM Personal Computer XT, still using the FAT12 file system
  * use 32 bits for storing block addresses
  * limit: 512 bytes/sector * (2 ^ 32) = 2 ^ 41 = 2 Tbytes maximum

* advantages over the MBR: 
  * use 64 bits for storing block addresses
  * limit: 512 bytes/sector * (2 ^ 64)ons is possible, depending on operating system supports
  * TODO
    
* Major Linux distros support GPT: Fedora above 8, Ubuntu above 8.04+ with tools such as gdisk, GNU Parted, util-linux v2.23+ fdisk, SYSLINUX, GRUB 0.96 + patches and GRUB 2 have been GPT-enabled.
  * kernel config CONFIG_EFI_PARTITION option enables GPT support in the kernel
    
  * command "blkid"
  * command "gdisk"
  * command "lsblk"
  
* ref
  * wiki MBR [link](https://en.wikipedia.org/wiki/Master_boot_record)
  * wiki GPT [link](https://en.wikipedia.org/wiki/GUID_Partition_Table)
  * k-M-G-T-P-E-Z-Y [link](http://ioanaspune.ro/wp-content/uploads/2015/03/tabel-1014x1024.jpg)
  * GPT kernel support [link](https://wiki.archlinux.org/index.php/partitioning#GPT_Kernel_Support)
  * TI Linux Core U-Boot User's Guide talking about how to use u-boot to make a GPT eMMC and boot from it [link](http://processors.wiki.ti.com/index.php/Linux_Core_U-Boot_User%27s_Guide)
  
///////////////////////////////////////////////////////////////////////////
## File System
  
There are currently two NTFS drivers available for Linux. The NTFS driver included in the kernel, and the userspace NTFS-3G driver that makes use of FUSE.

由 Tuxera 公司開發並維護的開源項目
為 Linux 提供 NTFS 分區的的驅動程式
2007年2月21日宣布NTFS-3G 1.0 釋出

* ref
  * Kernel NTFS driver vs NTFS-3G [link](https://superuser.com/questions/139452/kernel-ntfs-driver-vs-ntfs-3g)
  * 筆記 linux-support-ntfs-by-ntfs-3g [link](http://paul.pixnet.net/blog/post/11120651-%5B%E7%AD%86%E8%A8%98%5Dlinux-support-ntfs-by-ntfs-3g)
  
http://felix-lin.com/linux/kernel-ntfs-driver-and-ntfs-3g/

///////////////////////////////////////////////////////////////////////////












---------------------------------------------------------------------------------------

How to modify git site




---------------------------------------------------------------------------------------








Download the source
    https://gstreamer.freedesktop.org/download/

./configure CC=arm-linux-gnueabi-gcc CXX=arm-linux-gnurabi-g++ --host=arm-linux --build=i686-linux --prefix=/home/kclin/workspace/cross_result/pkg_config/ RANLIB=arm-linux-gnueabi-ranlib LD=arm-linux-gnueabi-ld --cache-file=arm-linux.cache LIBS="-L/home/kclin/workspace/cross_result/pkg_config/lib -lffi" CFLAGS="-I/home/kclin/workspace/cross_result/pkg_config/lib/libffi-3.0.13/include -I/home/kclin/workspace/cross_result/pkg_config/include"

make && make install



make OSDRV_CROSS=arm-hisiv500-linux CHIP=hi3519v101 FLASH_TYPE=spi all


a003257@ubuntu:~/avm/T533C$ ./sdk.unpack 
Unpacking SDK
WARN: Be sure you have installed the cross-compiler. if not, install it first!
WARN: ALL THE SOUCE FILES WILL BE OVERWRITED, FILES YOU MOTIFIED WILL BE LOST !!!

OS_TYPE  =linux
SDK_CHIP =hi3519v101
CUSTOMER_VERSION =
unpacking osal
run_command_progress_float: 'tar -xvzf package/osal.tgz'
[100%]##################################################|
unpacking osdrv
run_command_progress_float: 'tar -xvzf package/osdrv.tgz'
[100%]##################################################|
unpacking linux kernel
run_command_progress_float: 'tar -xvzf osdrv/opensource/kernel/linux-3.18.y.tgz -C osdrv/opensource/kernel/'
[100%]##################################################|
unpacking mpp_big-little
mkdir: created directory 'mpp_big-little'
run_command_progress_float: 'tar -xvzf package/mpp_big-little.tgz'
[100%]##################################################|
unpacking drv
mkdir: created directory 'drv'
run_command_progress_float: 'tar -xvzf package/drv.tgz'
[100%]##################################################|




hisilicon # printenv
bootdelay=1
baudrate=115200
bootfile="uImage"
filesize=4B9D7C
fileaddr=82000000
netmask=255.255.255.0
bootargs=mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs)
bootcmd=sf probe 0;sf read 0x82000000 0x100000 0x300000;bootm 0x82000000

serverip=10.1.9.108
nfshost=10.1.9.108
ipaddr=10.1.9.124
gatewayip=10.1.9.254
ethaddr=00:00:23:34:45:66

stdin=serial
stdout=serial
stderr=serial
verify=n
ver=U-Boot 2010.06 (Nov 30 2016 - 19:59:33)




setenv bootargs mem=64M console=ttyAMA0,115200 


setenv bootargs mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp


setenv bootargs mem=32M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp


set bootcmd 'sf probe 0;sf read 0x82000000 0x100000 0x300000;bootm 0x82000000'
set bootargs 'mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp'
set ipaddr 192.168.0.50
set serverip 192.168.0.100


---------------------------------------------------------------------------------------


hisilicon # printenv
bootdelay=1
baudrate=115200
bootfile="uImage"
filesize=4B9D7C
fileaddr=82000000
netmask=255.255.255.0
bootargs=mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs)
bootcmd=sf probe 0;sf read 0x82000000 0x100000 0x300000;bootm 0x82000000
serverip=10.1.9.108
nfshost=10.1.9.108
ipaddr=10.1.9.124
gatewayip=10.1.9.254
ethaddr=00:00:23:34:45:66
stdin=serial
stdout=serial
stderr=serial
verify=n
ver=U-Boot 2010.06 (Nov 30 2016 - 19:59:33)




setenv bootargs mem=64M console=ttyAMA0,115200 


setenv bootargs mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp

setenv bootargs mem=32M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),3M(kernel),28M(rootfs) ip=dhcp






sample/vio/sample_vio.c

__HuaweiLite__ is NOT used.

VO_INTF g_enVoIntfType video output interafce type

SAMPLE_VI_CONFIG_S video input configuration type

SENSOR_TYPE is defined in sample/Makefile.param

struct is typedefined as _S.

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

Hi3519V101 - Notes on using Hi3510V101

///////////////////////////////////////////////////////////////////////////

# mount -t nfs -o nolock 192.168.0.100:/nfsshare /mnt

# ./load3519v101 -i 
# ./load3519v101 -i -sensor0  imx274


///////////////////////////////////////////////////////////////////////////

D:\avm\t533c\Download_from_HiSilicon\Hi3519V101R001C01SPC040\01.software\pc\HiTool\HiTool 
IS NOT WORKING WITH DMB PROPERLY

SUSPECT: Fastbook in SPC040 is not compatible with the chip on DMB
However SPC030 is compatible

串口已经连接，请给单板上电，若已经上电，请断电后重新上电。

发送头帧失败，可能的原因如下：
1.烧写的Fastboot镜像与当前单板型号或Flash不匹配导致；
2.单板DDR有问题，无法正常进行DDR初始化操作；
3.如果是安全芯片，则需要确认是否需要使用programmer来进行烧写（Conax，Verimatrix高安类型必选）；
4.如果是安全芯片，则需要确认当前镜像是否已经签名且签名正确，注意签名使用的key必须与芯片启动校验的key一致；
下载文件失败！


///////////////////////////////////////////////////////////////////////////

ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- make menuconfig

ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- make modules M=`pwd`/drivers/media/i2c/it6604

ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- make uImage

ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- make clean

ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- make -C $(LINUX_ROOT) M=$(PWD) modules

///////////////////////////////////////////////////////////////////////////

U-boot

mw.b 82000000 ff 100000 #1MBytes
tftp 82000000 u-boot-hi3519v101.bin
sf probe 0
sf erase 0 100000
sf write 82000000 0 100000
reset

mw.b 82000000 ff 300000 #3MBytes
tftp 82000000 uImage_hi3519v101
sf probe 0
sf erase 100000 300000
sf write 82000000 100000 300000

mw.b 82000000 ff c00000 #12MBytes
tftp 82000000 rootfs_hi3519v101_64k.jffs2
sf probe 0
sf erase 400000 c00000
sf write 82000000 400000 c00000

(5)Separately compile uboot:
        Enter the top directory of boot source code, do the following,if your chip is hi3516av200, change the following hi3519v101     to hi3516av200:
        make ARCH=arm CROSS_COMPILE=arm-hisiv500-linux- hi3519v101_xxx_config
        make ARCH=arm CROSS_COMPILE=arm-hisiv500-linux-
        or:
        make ARCH=arm CROSS_COMPILE=arm-hisiv600-linux- hi3519v101_xxx_config
        make ARCH=arm CROSS_COMPILE=arm-hisiv600-linux-

        The generated u-boot.bin is copied to osdrv/tools/pc_tools/uboot_tools/ directory
        ./mkboot.sh reg_info.bin u-boot-hi3519v101.bin
        The generated u-boot-hi3519v101.bin is available for u-boot image


///////////////////////////////////////////////////////////////////////////

history:
	2017/11/03	init
	2017/12/07	move to version 4.0


Hi3519V101 SDK setup the SoC in u-boot:

From osdrv/tools/pc/uboot_tools/mkboot.sh 
original u-boot is split into two 
[first 64 byte][reg_info data up to 5120 bytes, padded with 0][the rest of u-boot]


Q: How to show a binary file?
  hexdump -C <file>
  dhex <file>
Q: How to compare two binary files?
  cmp -l <file 1> <file 2>
Q: How to use visual tool to compare two binary files
  vbindiff <file 1> <file 2>


Hi3519V101-uboot-DDR3_1866M_32bit_1GB-A7_792M-A17_930M-BUS_200M.xls
from folder Hi3519V101R001C01SPC040/02.only for reference/hardware/uboot table/DMEB
(DMEBPRO: for DDR4; DMEB: for DDR3)

Compare:
T533C_40/osdrv/tools/pc/uboot_tools/
	* Hi3519V101-DMEB-uboot-DDR3_1866M_32bit_1GB-A7_792M-A17_930M-BUS_200M.xlsm
	correspond to
	* reg_info_hi3519v101.bin


The Hi3519 chip on demo board can only use 

///////////////////////////////////////////////////////////////////////////

2017/11/09


Burn images to the SPI flash.

a 16 MB SPI flash is used as an example.

    1) Address space
        |      1 MB     |      4 MB     |     11 MB     |
        |---------------|---------------|---------------|
        |     boot      |     kernel    |     rootfs    |

1) Burn the U-boot.
	mw.b 82000000 ff 100000
	tftp 82000000 u-boot-hi3519v101.bin
	sf probe 0
	sf erase 0 100000
	sf write 82000000 0 100000	
	reset    

	Note that the network parameters need to be reconfigured after the reset.

2) Burn the kernel.
	mw.b 82000000 ff 400000
	tftp 82000000 uImage_hi3519v101
	sf probe 0;sf erase 100000 400000;sf write 82000000 100000 400000

3) Burn the file system.
	mw.b 82000000 ff B00000;
	tftp 82000000 rootfs_hi3519v101_64k.jffs2
	sf probe 0;sf erase 500000 B00000;sf write 82000000 500000 B00000

4) Set boot parameters. 
(Note that the file system is read-only by default for the linux-3.18.y kernel. 
Therefore, the rw option needs to be added to bootargs so that the file system can be read and written.)
		



///////////////////////////////////////////////////////////////////////////////



set ethaddr 00:00:23:34:45:66
set bootdelay 1; set baudrate 115200; 

set bootfile uImage; 
set fileaddr 82000000
set filesize 4B1D34 
 
set ipaddr 192.168.0.50;set serverip 192.168.0.100;set netmask 255.255.255.0

set bootargs 'mem=64M console=ttyAMA0,115200 root=/dev/mtdblock2 rootfstype=jffs2 rw mtdparts=hi_sfc:1M(boot),4M(kernel),11M(rootfs) ip=dhcp'

set bootcmd 'sf probe 0;sf read 0x82000000 0x100000 0x400000;bootm 0x82000000'

stdin=serial
stdout=serial
stderr=serial
verify=n

///////////////////////////////////////////////////////////////////////////////

default demo board u-boot settings




